if(void 0===window.giftbeeloaded||null===document.getElementById("giftbee-loaded")){try{window.giftbeeloaded=!0;var elem54214243=document.createElement("div");elem54214243.id="giftbee-loaded",elem54214243.style.cssText="display:none;",document.body.appendChild(elem54214243)}catch(t){console.error(t)}!function(){var t={bucket:0,capacity:10,delay:500,add:function(){this.bucket++,this.clearBucket()},clearBucketTimeout:null,clearBucket:function(){null!==this.clearBucketTimeout&&clearTimeout(this.clearBucketTimeout);var t=this;setTimeout((function(){t.bucket=0}),this.delay)},hasSpace:function(){return this.bucket<this.capacity}};!function(e){for(var n=[{id:3740,name:"B-Series Chart Bundle",must_include_any_variant:"true",remove_the_initial_variants:"true",works_in_reverse:"false",status:"enabled",apply_once_per_cart:"false",condition_type:"products",cart_value_min:"0",cart_value_max:"",cart_value_max_enable:"false",apply_once_per_session:"false",apply_only_on_add_to_cart:"false",products_min:"0",products_max:"",products_max_enable:"false",product_variants_contain:[{product_id:"6886869205074",variant_id:"39963225522258",title:"B-Series Chart Bundle - (1:500,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1}],product_variants_add:[{product_id:"6754116239442",variant_id:"39664798793810",title:"B1/B2 VNC Northland/ Auckland/ Marlborough/ Canterbury - (1:500,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754752626770",variant_id:"39665596596306",title:"B3/B4 VNC Tairawhiti/Canterbury/Otago - (1:500,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754753085522",variant_id:"39665597153362",title:"B5/B6 VNC Wellington/Taranaki/Southland - (1:500,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1}],use_date_condition:"false",date_from:null,date_to:null},{id:3742,name:"C-Series Complete Charts",must_include_any_variant:"false",remove_the_initial_variants:"true",works_in_reverse:"false",status:"enabled",apply_once_per_cart:"false",condition_type:"products",cart_value_min:"0",cart_value_max:"",cart_value_max_enable:"false",apply_once_per_session:"false",apply_only_on_add_to_cart:"false",products_min:"0",products_max:"",products_max_enable:"false",product_variants_contain:[{product_id:"6887493468242",variant_id:"39965032448082",title:"C-Series Complete Chart Bundle - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1}],product_variants_add:[{product_id:"6754073346130",variant_id:"39664786014290",title:"C1/C2 VNC Northland/Wellington - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754074361938",variant_id:"39664787685458",title:"C3/C4 VNC Auckland North/Hawke's Bay - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754076131410",variant_id:"39664788275282",title:"C5/C6 VNC Napier/Gisborne/Auckland South - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754077835346",variant_id:"39664791126098",title:"C7/C8 VNC Marlborough/Bay of Plenty - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754080391250",variant_id:"39664791846994",title:"C9/C10 VNC Mackenzie/Taranaki - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754083864658",variant_id:"39664793059410",title:"C11/C12 VNC Waikato/Buller – (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754102181970",variant_id:"39664796532818",title:"C13/C14 VNC Kaikoura/Invercargill - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754105819218",variant_id:"39664797155410",title:"C15/C16 VNC Fiordland/Westland - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754108702802",variant_id:"39664797417554",title:"C17/C18 VNC Queenstown/Tasman - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754111127634",variant_id:"39664798367826",title:"C19/C20 VNC Dunedin/Christchurch - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1}],use_date_condition:"false",date_from:null,date_to:null},{id:3743,name:"C-Series North Island Charts",must_include_any_variant:"false",remove_the_initial_variants:"true",works_in_reverse:"false",status:"enabled",apply_once_per_cart:"false",condition_type:"products",cart_value_min:"0",cart_value_max:"",cart_value_max_enable:"false",apply_once_per_session:"false",apply_only_on_add_to_cart:"false",products_min:"0",products_max:"",products_max_enable:"false",product_variants_contain:[{product_id:"6887501791314",variant_id:"39965044637778",title:"C-Series North Island Chart Bundle - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1}],product_variants_add:[{product_id:"6754073346130",variant_id:"39664786014290",title:"C1/C2 VNC Northland/Wellington - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754074361938",variant_id:"39664787685458",title:"C3/C4 VNC Auckland North/Hawke's Bay - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754076131410",variant_id:"39664788275282",title:"C5/C6 VNC Napier/Gisborne/Auckland South - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754077835346",variant_id:"39664791126098",title:"C7/C8 VNC Marlborough/Bay of Plenty - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754080391250",variant_id:"39664791846994",title:"C9/C10 VNC Mackenzie/Taranaki - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754083864658",variant_id:"39664793059410",title:"C11/C12 VNC Waikato/Buller – (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1}],use_date_condition:"false",date_from:null,date_to:null},{id:3744,name:"C-Series South Island Charts",must_include_any_variant:"false",remove_the_initial_variants:"true",works_in_reverse:"false",status:"enabled",apply_once_per_cart:"false",condition_type:"products",cart_value_min:"0",cart_value_max:"",cart_value_max_enable:"false",apply_once_per_session:"false",apply_only_on_add_to_cart:"false",products_min:"0",products_max:"",products_max_enable:"false",product_variants_contain:[{product_id:"6887502282834",variant_id:"39965045784658",title:"C-Series South Island Chart Bundle - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1}],product_variants_add:[{product_id:"6754077835346",variant_id:"39664791126098",title:"C7/C8 VNC Marlborough/Bay of Plenty - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754080391250",variant_id:"39664791846994",title:"C9/C10 VNC Mackenzie/Taranaki - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754083864658",variant_id:"39664793059410",title:"C11/C12 VNC Waikato/Buller – (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754102181970",variant_id:"39664796532818",title:"C13/C14 VNC Kaikoura/Invercargill - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754105819218",variant_id:"39664797155410",title:"C15/C16 VNC Fiordland/Westland - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754108702802",variant_id:"39664797417554",title:"C17/C18 VNC Queenstown/Tasman - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1},{product_id:"6754111127634",variant_id:"39664798367826",title:"C19/C20 VNC Dunedin/Christchurch - (1:250,000) – 1 Dec 2022",selling_plan_name:"",selling_plan_id:"",quantity:1}],use_date_condition:"false",date_from:null,date_to:null}],i=[],a=(new Date).getTime(),o=0;o<n.length;o++){var r=!0;if(void 0!==n[o].use_date_condition&&"true"===n[o].use_date_condition){if(void 0!==n[o].date_from&&null!==n[o].date_from&&""!==n[o].date_from.trim())new Date(n[o].date_from).getTime()>a&&(r=!1);if(void 0!==n[o].date_to&&null!==n[o].date_to&&""!==n[o].date_to.trim())new Date(n[o].date_to).getTime()<a&&(r=!1)}!0===r&&i.push(n[o])}if("undefined"!=typeof Shopify&&void 0!==Shopify.currency&&void 0!==Shopify.currency.rate)for(var l=1*Shopify.currency.rate,c=0;c<i.length;c++){var d=i[c];"cart_value"===d.condition_type&&(""!==d.cart_value_min&&(d.cart_value_min=d.cart_value_min*l),""!==d.cart_value_max&&(d.cart_value_max=d.cart_value_max*l))}var s=[];function u(t,e,n){void 0!==s[t]&&clearTimeout(s[t]),s[t]=setTimeout(e,n)}var p,_,f,h=(p={key:"cartbot_data_",save:function(t,e){try{localStorage.setItem(this.getKey()+t,e)}catch(t){console.log("Error when saving data",t)}},getKey:function(){return this.key}},{cart:{cartData:{items:[]},get:function(e,n){if(void 0===e&&(e=!0),void 0===n&&(n=!0),e){var i=Date.now();if(i=Math.round(i/1500),Object.keys(this.cartData).length>0){y&&console.log("---- reading cart data from cache via promise ----");var a=this;return new Promise(((t,e)=>{t(new Response(JSON.stringify(a.cartData),{status:200,statusText:"Smashing success!"}))}))}}return!1===t.hasSpace()?(console.log("leaky bucket is full"),null):(t.add(),a=this,fetch(_.getRootUrl()+"cart.json?cartbot-cart-call",{method:"GET",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"}}).then((function(t){return t.clone().json().then((function(e){var i=JSON.parse(JSON.stringify(e));if(void 0!==window.bndlr&&"function"==typeof window.bndlr.updateCartWithDiscounts)try{var o=window.bndlr.updateCartWithDiscounts(i);void 0!==o.discounted_cart_object&&(i=o.discounted_cart_object)}catch(t){console.log(t)}return y&&console.log("---- saving cart data to cache ----",JSON.parse(JSON.stringify(i))),a.cartData=JSON.parse(JSON.stringify(i)),m=!1,n&&p.save("cart",JSON.stringify(i)),t}))})))}},nav:_={getRootUrl:function(){return window.location.origin?window.location.origin+"/":window.location.protocol+"/"+window.location.host+"/"},isHomePage:function(){return"/"===window.location.pathname},isProductPage:function(){return!!/\/products\/([^\?\/\n]+)/.test(window.location.href)},isCartPage:function(){return!!/\/cart\/?/.test(window.location.href)},getProductHandle:function(t){if(void 0===t&&(t=(t=window.location.href).replace("/products/products","/products")),/\/products\/([^\?\/\n]+)/.test(t)){var e=t.match(/\/products\/([^\?\/\n]+)/);if(void 0!==e[1])try{return decodeURIComponent(e[1]).replace("#","")}catch(t){return e[1].replace("#","")}}return!1},getAppApiEndpoint:function(){return"https://app.cart-bot.net/public/api/"},getInvoiceEndpoint:function(){return this.getAppApiEndpoint()+"cdo.php?shop=pilot-shop-nz.myshopify.com"},getSellingPlanId:function(){var t=this.getQueryParams(window.location.search);return void 0!==t.selling_plan?t.selling_plan:""},getQueryParams:function(t){t=t.split("+").join(" ");for(var e,n={},i=/[?&]?([^=]+)=([^&]*)/g;e=i.exec(t);)n[decodeURIComponent(e[1])]=decodeURIComponent(e[2]);return n},reload:function(){window.location=self.location,window.location.reload(!0)},isQueryParameterSet:function(t){return void 0!==this.getQueryParams(window.location.search)[t]}},string:{getRandomString:function(t){for(var e="abcdefghijklmnopqrstuvwxyz0123456789",n=e.length,i=[],a=0;a<t;a++)i.push(e.charAt(Math.floor(Math.random()*n)));return i.join("")}},queue:{queue:{},add:function(t,e,n){void 0===this.queue[t]&&(this.queue[t]={finish:n,q:[],tick:0}),this.queue[t].q.push(e)},process:function(t){if(void 0!==this.queue[t]){this.queue[t].q.length;var e=this.queue[t].tick;void 0!==this.queue[t].q[e]&&(this.queue[t].q[e](),this.tick(t))}},tick:function(t){void 0!==this.queue[t]&&(this.queue[t].tick++,this.queue[t].tick===this.queue[t].q.length?(this.queue[t].finish(),delete this.queue[t]):this.process(t))},cancel:function(t){delete this.queue[t]}},promiseQueue:f={queue:{},add:function(t,e,n){void 0===this.queue[t]&&(this.queue[t]={finish:n,q:[],tick:0}),this.queue[t].q.push(e)},process:function(t){if(void 0!==this.queue[t]){this.queue[t].q.length;var e=this.queue[t].tick;void 0!==this.queue[t].q[e]&&this.queue[t].q[e]().then((function(){setTimeout((function(){f.tick(t)}),10)}))}},tick:function(t){void 0!==this.queue[t]&&(this.queue[t].tick++,this.queue[t].tick===this.queue[t].q.length?(this.queue[t].finish(),delete this.queue[t]):this.process(t))},cancel:function(t){delete this.queue[t]}},cookie:{key:"cartbot_data_",maxAge:36e5,set:function(t,e,n){var i=new Date;t=this.key+t;var a={data:JSON.parse(e),time:(new Date).getTime()};if(e=JSON.stringify(a),n>0){i.setTime(i.getTime()+24*n*60*60*1e3);var o="expires="+i.toUTCString();document.cookie=t+"="+e+";"+o+";path=/"}else document.cookie=t+"="+e+";path=/"},get:function(t){var e=(t=this.key+t)+"=",n=document.cookie;n=n.split(";");for(var i=[],a=0;a<n.length;a++)try{i.push(decodeURIComponent(n[a].trim(" ")))}catch(t){console.error(n[a])}var o="";for(a=0;a<i.length;a++){for(var r=i[a];" "==r.charAt(0);)r=r.substring(1);0==r.indexOf(e)&&(o=r.substring(e.length,r.length),a=i.length)}try{var l=JSON.parse(o);return void 0===l.time?o:l.time<(new Date).getTime()-this.maxAge?"":JSON.stringify(l.data)}catch(t){}return""}}}),y=!1,m=!1,v=function(){function e(t,e){for(;t&&1===t.nodeType;){if(t.matches(e))return t;t=t.parentNode}return null}function n(){if(void 0!==window.bndlr&&"function"==typeof bndlr.canUseCheckout&&"function"==typeof bndlr.checkout&&!0===bndlr.canUseCheckout())return bndlr.checkout(),!0;window.location.href="/checkout"}function a(t,e){var n=h.cart.get(!1).then((function(n){return function(t,e,n){void 0===n&&(n="");var i=s(void 0,e,n),a=JSON.parse(JSON.stringify(i.remove));if(i.add.length>0)return _(i.add).then((function(e){a.length>0?f(a).then((function(e){t&&h.nav.isCartPage()&&h.nav.reload()})):t&&h.nav.isCartPage()&&(console.log("reloading the cart page"),h.nav.reload())}));if(i.remove.length>0)return f(i.remove).then((function(e){t&&h.nav.isCartPage()&&h.nav.reload()}));return new Promise(((t,e)=>{t(new Response("",{status:200,statusText:"Fallback promise."}))}))}(!0,t,e)}));return n}function o(){return y&&console.log("== refreshing local cart =="),h.cart.get(!1)}function r(arguments,t){void 0===t&&(t=!1);var e=arguments[0],n=arguments[1],i=c(e,"add"),a=c(e,"change"),o={};if(i||t&&a)if("object"==typeof n&&"object"==typeof n.body)for(var r of n.body.entries())o[r[0]]=r[1];else if("object"==typeof n&&"string"==typeof n.body&&void 0!==n.headers&&"string"==typeof n.headers["Content-Type"]&&-1!==n.headers["Content-Type"].indexOf("application/json"))try{o=JSON.parse(n.body)}catch(t){}else if("object"==typeof n&&"string"==typeof n.body)o=h.nav.getQueryParams(n.body);else if("object"==typeof n&&void 0===n.body)try{for(var r of n.entries())o[r[0]]=r[1]}catch(t){console.log(t)}else if("string"==typeof n){try{o=JSON.parse(n)}catch(t){}if(0===Object.keys(o).length)try{o=h.nav.getQueryParams(n)}catch(t){}}if(void 0!==o.line&&void 0===o.id){var l=JSON.parse(JSON.stringify(h.cart.cartData)),d=1*o.line;d-=1,void 0!==l.items&&void 0!==l.items[d]&&(o.id=l.items[d].id,o.key=l.items[d].key)}if(void 0!==o.items&&void 0!==o.items[0]){var s=o.items;(o=o.items[0]).items=s}if(void 0!==o["id[]"]&&(o.id=o["id[]"]),void 0!==o["items[0][id]"]&&(o.id=o["items[0][id]"]),void 0!==o["items[0][quantity]"]&&(o.quantity=o["items[0][quantity]"]),void 0!==o["items[0][selling_plan]"]&&(o.selling_plan=o["items[0][selling_plan]"]),void 0!==o.id){var u=1;void 0!==o.quantity&&(u=o.quantity);var p="";void 0!==o.selling_plan&&(p=o.selling_plan);var _=[];if(void 0!==o.items&&o.items.length>1)for(var f=0;f<o.items.length;f++){var y=o.items[f];if(void 0!==y.id){var m=1;void 0!==y.quantity&&(m=y.quantity);var v="";void 0!==y.selling_plan&&(v=y.selling_plan);var g={id:y.id,quantity:m,selling_plan:v};_.push(g)}}return{id:o.id,quantity:u,selling_plan:p,other_items:_}}return!1}function l(arguments){var t=arguments[0],e=["/cart/"],n=!1;if("string"==typeof t)for(var i=0;i<e.length;i++)-1!==t.indexOf(e[i])&&-1===t.indexOf("cartbot-cart-call")&&(n=!0,i=e.length);return n}function c(t,e){var n={add:["/cart/add.js","/cart/add.json","/cart/add"],change:["/cart/change.js","/cart/change.json","/cart/change","/cart/update.js","/cart/update.json","/cart/update"]};if(void 0===n[e])return!1;var i=n[e],a=!1;if("string"==typeof t)for(var o=0;o<i.length;o++)-1!==t.indexOf(i[o])&&-1===t.indexOf("cartbot-cart-call")&&(a=!0,o=i.length);return a}function d(t,e,n){var i={add:[],remove:[]};if(void 0!==t.other_items&&t.other_items.length>1)for(var a=0;a<t.other_items.length;a++){var o=s(t.other_items[a],e,n);void 0!==o.add&&o.add.length>0&&(i.add=i.add.concat(o.add)),void 0!==o.remove&&o.remove.length>0&&(i.remove=i.remove.concat(o.remove))}else i=s(t,e,n);return i}function s(t,e,n){if(y&&(console.log("---- getActions ----"),console.trace()),void 0===e&&(e=!1),void 0!==window.completelyDisableCartbotApp&&!0===window.completelyDisableCartbotApp)return console.log("Cartbot app was disabled by the completelyDisableCartbotApp variable"),{add:[],remove:[]};void 0===n&&(n="");var a=JSON.parse(JSON.stringify(h.cart.cartData));JSON.parse(JSON.stringify(a));y&&console.log("cart in getActions",JSON.parse(JSON.stringify(a)));var o=[];if(void 0!==t){var r=!1;if(a.items.length>0)for(var l=0;l<a.items.length;l++){var c="";void 0!==a.items[l].selling_plan_allocation&&(c=a.items[l].selling_plan_allocation.selling_plan.id);var d="";void 0!==t.selling_plan&&(d=t.selling_plan),1*a.items[l].id!=1*t.id&&a.items[l].key!==t.id||c+""!=d+""||(a.items[l].quantity="change"===n?1*t.quantity:1*a.items[l].quantity+1*t.quantity,r=!0)}if(!1===r&&"change"!==n){var s={id:1*t.id,quantity:1*t.quantity,key:1*t.id};void 0!==t.selling_plan&&null!==t.selling_plan&&(s.selling_plan_allocation={selling_plan:{id:t.selling_plan}}),a.items.push(s)}void 0!==t.quantity&&t.quantity}var u=0;if(a.items.length>0)for(l=0;l<a.items.length;l++)void 0!==a.items[l].line_price&&(u+=a.items[l].line_price);u/=100,y&&console.log("totalCartValue",u);for(var p=[],_=[],f=0;f<i.length;f++)for(var m=i[f],v=!0,g=0;v&&g<100;){v=!1,g++;var w=JSON.parse(JSON.stringify(a)),C=!0,q="true"!==m.must_include_any_variant,b="true"===m.works_in_reverse;"n_products"===m.condition_type&&(q=!1);var S=!1,N=[],k=!1;if("true"===m.apply_once_per_session&&!0!==e)try{""!==(I=h.cookie.get("applied_rules"))&&(I=JSON.parse(I)),void 0!==I["_"+m.id]&&(k=!0,C=!1)}catch(t){console.error("cartbot",t)}if("products"===m.condition_type||"n_products"===m.condition_type){if(m.product_variants_contain.length>0){for(var D=0,O=0,E=0;E<m.product_variants_contain.length;E++)for(var T=m.product_variants_contain[E],x=0;x<a.items.length;x++){c="";if(void 0!==(s=a.items[x]).selling_plan_allocation&&(c=s.selling_plan_allocation.selling_plan.id+""),1*T.variant_id==1*s.id&&s.quantity>0&&s.quantity>=T.quantity&&(T.selling_plan_id+""===c||"one_time_or_any"===T.selling_plan_id||"any"===T.selling_plan_id&&""!==c))if("n_products"===m.condition_type){var J=null;"true"===m.products_max_enable?(J=1*m.products_max,J-=D):J=99999999;var j=s.quantity;j>J&&(j=J),D++,O+=j,s.quantity=s.quantity-j,y&&console.log("Reducing quantity of item "+s.id+" for quantity of "+j+" because of "+m.name+" rule"),N.push({id:T.variant_id,quantity:j,line_key:s.key})}else D++,s.quantity=s.quantity-T.quantity,y&&console.log("Reducing quantity of item "+s.id+" for quantity of "+T.quantity+" because of "+m.name+" rule"),N.push({id:T.variant_id,quantity:T.quantity,line_key:s.key});!0===q?D===m.product_variants_contain.length&&(x=a.items.length):"n_products"===m.condition_type?"true"===m.products_max_enable&&O>=1*m.products_max?(x=a.items.length,y&&console.log("Stopping the loop")):y&&console.log("NOT stopping the loop"):D>0?(x=a.items.length,y&&console.log("Stopping the loop"),"false"===m.apply_once_per_cart&&(E=m.product_variants_contain.length)):y&&console.log("NOT stopping the loop")}C=!0===q?D===m.product_variants_contain.length:"n_products"===m.condition_type?O>=1*m.products_min:D>0}}else"cart_value"===m.condition_type&&(C=!1,"true"===m.cart_value_max_enable?1*m.cart_value_min<=u&&1*m.cart_value_max>=u&&(C=!0):1*m.cart_value_min<=u&&(C=!0));if(y&&console.log("canAddItems",C),C){if("true"===m.apply_only_on_add_to_cart&&"add"!==n){v=!1;continue}if(m.product_variants_add.length>0){for(E=0;E<m.product_variants_add.length;E++){var P=(L=m.product_variants_add[E]).quantity,A=!1;if("add"!==n||"true"===m.apply_once_per_cart||"false"===m.remove_the_initial_variants)for(x=0;x<a.items.length;x++){c="";if(void 0!==(s=a.items[x]).selling_plan_allocation&&(c=s.selling_plan_allocation.selling_plan.id),1*L.variant_id==1*s.id&&s.quantity>0&&c+""==L.selling_plan_id+""){var Q=s.quantity;if(Q>L.quantity&&(Q=L.quantity),P<Q&&(Q=P),"true"===m.remove_the_initial_variants&&"false"===m.apply_once_per_cart||(P-=Q)<0&&(P=0),A=!0,s.quantity=s.quantity-Q,x=a.items.length,y&&(console.log("Subtracting quantity of item "+s.id+" for quantity of "+Q+" because of "+m.name+" rule"),console.log("New quantity "+s.quantity)),"true"===m.apply_once_per_cart&&s.quantity>0&&b&&"cart_value"!==m.condition_type){var V=JSON.parse(JSON.stringify(m));o.push(V),v=!1}if("true"===m.apply_once_per_cart&&s.quantity>0&&b&&"cart_value"===m.condition_type){V=JSON.parse(JSON.stringify(m));o.push(V),v=!1}}}!1===A||!0===A&&P>0?(!1===k&&p.push({id:L.variant_id,quantity:P,selling_plan:L.selling_plan_id}),S=!0,y&&console.log("Adding variant "+L.variant_id+" to the cart with quantity of "+P+" because of "+m.name+" rule."),"false"===m.apply_once_per_cart&&"cart_value"!==m.condition_type&&(v=!0)):("false"===m.apply_once_per_cart&&"cart_value"!==m.condition_type&&(v=!0),N.length>0&&"true"===m.remove_the_initial_variants&&"false"===m.apply_once_per_cart&&(S=!0))}if("true"===m.apply_once_per_session&&!0===S&&!0!==e)try{var I;(I=""!==(I=h.cookie.get("applied_rules"))?JSON.parse(I):{})["_"+m.id]=m.id,h.cookie.set("applied_rules",JSON.stringify(I),0)}catch(t){}}}else a=JSON.parse(JSON.stringify(w)),b&&(y&&console.log("Adding rule in for removal",JSON.parse(JSON.stringify(m)),JSON.parse(JSON.stringify(w))),o.push(JSON.parse(JSON.stringify(m))));"true"===m.remove_the_initial_variants&&!0===S&&(_=_.concat(JSON.parse(JSON.stringify(N)))),N=[]}if(y&&console.log("rulesForRemoval",JSON.parse(JSON.stringify(o))),o.length>0)for(var R=0;R<o.length;R++){m=o[R];var B=[],M=a;for(E=0;E<m.product_variants_add.length;E++){var L=m.product_variants_add[E];for(x=0;x<M.items.length;x++){c="";if(void 0!==(s=M.items[x]).selling_plan_allocation&&(c=s.selling_plan_allocation.selling_plan.id+""),1*L.variant_id==1*s.id&&s.quantity>0&&L.selling_plan_id+""===c){x=M.items.length;var U=1*L.quantity;"cart_value"===m.condition_type&&s.quantity>1*L.quantity&&(U=s.quantity),"true"===m.works_in_reverse&&(U=s.quantity),B.push({id:L.variant_id,quantity:1*U,line_key:s.key}),s.quantity-=1*U,y&&(console.log("Removing variant "+L.variant_id+" for quantity of "+U+" because of "+m.name+" rule"),console.log("Current quantity "+s.quantity+". Item id "+s.id),console.log(JSON.parse(JSON.stringify(M))))}}}_=_.concat(JSON.parse(JSON.stringify(B)))}return y&&h.nav.isQueryParameterSet("test")?{add:[],remove:[]}:(y&&console.log({add:p,remove:_}),{add:p,remove:_})}function p(){if("function"==typeof window.SLIDECART_UPDATE)try{window.SLIDECART_UPDATE()}catch(t){}if(void 0!==window.theme&&void 0!==window.theme.ajaxCart&&"function"==typeof window.theme.ajaxCart.update)try{window.theme.ajaxCart.update()}catch(t){}if("function"==typeof window.icartCartActivityEvent)try{window.icartCartActivityEvent()}catch(t){}try{document.dispatchEvent(new CustomEvent("cart:refresh"))}catch(t){}try{document.documentElement.dispatchEvent(new CustomEvent("cart:refresh",{bubbles:!0}))}catch(t){}try{document.dispatchEvent(new CustomEvent("product:added",{detail:{quantity:1},bubbles:!0}))}catch(t){}if(void 0!==window.HsCartDrawer&&"function"==typeof window.HsCartDrawer.updateSlideCart&&u("hscartdrawer",(function(){try{HsCartDrawer.updateSlideCart()}catch(t){console.log(t)}}),100),void 0!==window.HS_SLIDE_CART_OPEN&&"function"==typeof window.HS_SLIDE_CART_OPEN&&u("hscartdraweropen",(function(){try{window.HS_SLIDE_CART_OPEN()}catch(t){bundlerConsole.log(t)}}),100),"undefined"!=typeof theme&&void 0!==theme.Cart&&"function"==typeof theme.Cart.updateCart)try{theme.Cart.updateCart()}catch(t){}if("function"==typeof window.updateMiniCartContents)try{window.updateMiniCartContents()}catch(t){}if("function"==typeof window.loadEgCartDrawer)try{window.loadEgCartDrawer()}catch(t){}try{document.dispatchEvent(new CustomEvent("cart:build"))}catch(t){}try{document.dispatchEvent(new CustomEvent("obsidian:upsell:refresh")),document.dispatchEvent(new CustomEvent("obsidian:upsell:open"))}catch(t){}var t=document.getElementById("site-cart");if(null!==t)try{t.show()}catch(t){}if("undefined"!=typeof CartJS&&"function"==typeof CartJS.getCart)try{CartJS.getCart()}catch(t){console.log(t)}if(void 0!==window.SLIDECART_UPDATE)try{window.SLIDECART_UPDATE()}catch(t){bundlerConsole.log(t)}if(void 0!==window.SLIDECART_OPEN&&setTimeout((function(){try{window.SLIDECART_OPEN()}catch(t){bundlerConsole.log(t)}}),500),"undefined"!=typeof Shopify&&void 0!==Shopify.theme&&void 0!==Shopify.theme.jsAjaxCart&&"function"==typeof Shopify.theme.jsAjaxCart.updateView)try{Shopify.theme.jsAjaxCart.updateView()}catch(t){}if("undefined"!=typeof Shopify&&void 0!==Shopify.theme&&void 0!==Shopify.theme.ajaxCart&&"function"==typeof Shopify.theme.ajaxCart.updateView)try{h.cart.get(!1).then((function(t){t.clone().json().then((function(t){Shopify.theme.ajaxCart.updateView({cart_url:window.location.origin+"/cart"},t)}))}))}catch(t){}if(void 0!==window.theme&&void 0!==window.theme.MiniCart&&"function"==typeof window.theme.MiniCart.update)try{theme.MiniCart.update()}catch(t){}try{h.cart.get(!1).then((function(t){t.clone().json().then((function(t){document.dispatchEvent(new CustomEvent("theme:cart:reload"))}))}))}catch(t){console.error(t)}try{h.cart.get(!1).then((function(t){t.clone().json().then((function(t){if(void 0!==t.item_count){var e=t.item_count,n=document.querySelector("cart-count");null!==n&&(n.innerHTML=e)}"undefined"!=typeof window&&void 0!==window.wetheme&&void 0!==window.wetheme.updateCartDrawer&&window.wetheme.updateCartDrawer(t)}))}))}catch(t){}try{var e=document.querySelector("cart-notification")||document.querySelector("cart-drawer")||document.querySelector("product-form.product-form");if(null!==e&&"function"==typeof e.renderContents){var n="cart-drawer,cart-icon-bubble";if("function"==typeof e.getSectionsToRender){var i=[];n=e.getSectionsToRender();for(var a in n)n.hasOwnProperty(a)&&("string"==typeof n[a].section?i.push(n[a].section):"string"==typeof n[a].id&&i.push(n[a].id));i.length>0&&(n=i.join(","))}fetch(h.nav.getRootUrl()+"cart?sections="+n,{method:"GET",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"}}).then((function(t){try{return t.clone().json().then((function(t){try{var n={sections:t};e.renderContents(n)}catch(t){console.error(t)}}))}catch(t){console.error(t)}}))}}catch(t){console.error(t)}try{setTimeout((()=>{document.dispatchEvent(new CustomEvent("dispatch:cart-drawer:refresh"))}),500)}catch(t){}try{"function"===window.$&&window.$("form.cart-drawer").length>0&&(window.$(".cart-drawer input").first().trigger("blur"),setTimeout((function(){window.$(".cart-drawer input").first().trigger("input")}),350))}catch(t){console.log(t)}try{window.dispatchEvent(new Event("update_cart"))}catch(t){}try{void 0!==window.theme&&void 0!==window.theme.cart&&"function"==typeof window.theme.cart._updateCart&&window.theme.cart._updateCart()}catch(t){}if(void 0!==window.ajaxCart&&"function"==typeof window.ajaxCart.load)try{ajaxCart.load()}catch(t){}if(void 0!==window.Shopify&&"function"==typeof window.Shopify.onItemAdded)try{window.Shopify.onItemAdded()}catch(t){}}async function _(e,n,i){void 0===n&&(n=!0);for(var a={items:[]},o=0;o<e.length;o++){var r={id:e[o].id,quantity:e[o].quantity};void 0!==e[o].selling_plan&&""!==e[o].selling_plan&&(r.selling_plan=e[o].selling_plan),void 0!==i&&(r.properties=i);for(var l=!1,c=0;c<a.items.length;c++)a.items[c].id!==r.id||typeof r.selling_plan!=typeof a.items[c].selling_plan||void 0!==r.selling_plan&&r.selling_plan!==a.items[c].selling_plan||(a.items[c].quantity+=r.quantity,l=!0);!1===l&&a.items.push(r)}return!1===t.hasSpace()?(console.log("leaky bucket is full"),null):(t.add(),await fetch("/cart/add?cartbot-cart-call",{method:"POST",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(a)}).then((function(t){if(n&&(void 0===t.status||200!==t.status))throw console.log("Couldnt add products to the cart!"),new Error("Cartbot: Couldnt add the product to the cart automatically. Please recreate your bot or check that the product you are trying to add exists and has the correct selling plan selected (if needed). "+t.status);if("function"==typeof window.$)try{window.$("body").trigger("added.ajaxProduct"),document.documentElement.dispatchEvent(new CustomEvent("cart:refresh",{}))}catch(t){}try{p()}catch(t){console.error(t)}})).catch((function(t){return console.log("error",t),null})))}async function f(t){for(var e={},n=0;n<t.length;n++){var i=t[n],a=i.line_key;void 0===e[a]?e[a]={id:i.id,line_key:i.line_key,removable_quantity:1*i.quantity}:e[a].removable_quantity+=i.quantity}return h.cart.get(!1).then((function(t){return t.clone().json().then((function(t){var n={};for(var i in e)if(e.hasOwnProperty(i)){for(var a=!1,o=0;o<t.items.length;o++){if(t.items[o].key===i&&t.items[o].quantity>0)(c=t.items[o].quantity-e[i].removable_quantity)<0&&(c=0),t.items[o].quantity=c,n[i]=c,a=!0}if(!1===a)for(o=0;o<t.items.length;o++){if(0===t.items[o].key.indexOf(i)&&t.items[o].quantity>0)(c=t.items[o].quantity-e[i].removable_quantity)<0&&(c=0),n[i]=c,a=!0}if(!1===a){var r=i.split(":"),l="";void 0!==r[0]&&(l=r[0]);for(o=0;o<t.items.length;o++){var c;if(0===t.items[o].key.indexOf(l)&&t.items[o].quantity>0)(c=t.items[o].quantity-e[i].removable_quantity)<0&&(c=0),n[i]=c,a=!0}}}return fetch("/cart/update.js?cartbot-cart-call",{method:"POST",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify({updates:n})}).then((function(t){if("function"==typeof window.$)try{window.$("body").trigger("added.ajaxProduct"),document.documentElement.dispatchEvent(new CustomEvent("cart:refresh",{}))}catch(t){}try{p()}catch(t){console.error(t)}}))}))}))}return{init:function(){if(void 0!==window.completelyDisableCartbotApp&&!0===window.completelyDisableCartbotApp)return console.log("Cartbot is disabled via completelyDisableCartbotApp variable."),!0;var t;t=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.send=function(e){var n=this._url,i=!1;if("string"==typeof n&&n.length>0){var d=h.string.getRandomString(10);try{var u=this.onreadystatechange;if(this.onreadystatechange=function(){"function"==typeof u&&u.apply(this,arguments),200===this.status&&4===this.readyState&&h.promiseQueue.process(d)},c(n,"change")){var p=r([n,arguments[0]],!0);if((g=s(p,!1,"change")).remove.length>0){var y=arguments,v=this;i=!0,f(g.remove).then((function(e){t.apply(v,y)}))}else h.promiseQueue.add(d,(function(){return a(!1,"change")}),(function(){}))}else{var g;!1!==(p=r([n,arguments[0]]))&&(m=!0,h.promiseQueue.add(d,(function(){return o()}),(function(){})),(g=s(p,!1,"add")).add.length>0?(y=arguments,v=this,i=!0,_(g.add,!1).then((function(e){t.apply(v,y),g.remove.length>0&&h.promiseQueue.add(d,(function(){return f(g.remove)}),(function(){}))}))):g.remove.length>0?(y=arguments,v=this,f(g.remove).then((function(t){h.promiseQueue.process(d)}))):h.promiseQueue.add(d,(function(){return a(!1,"add")}),(function(){})))}}catch(t){console.log("Cartbot"),console.error(t)}l(arguments)&&(m=!0,h.promiseQueue.add(d,(function(){return o()}),(function(){})))}!0!==i&&t.apply(this,arguments)},function(t){if("function"==typeof t.fetch)try{var e=t.fetch;t.fetch=function(){var t=h.string.getRandomString(10);try{if(c(arguments[0],"change")){h.promiseQueue.add(t,(function(){return a(!1,"change")}),(function(){}));var n=r(arguments,!0);if((p=s(n,!1,"change")).add.length>0){if(1===p.add.length){if(1*p.add[0].id===n.id)return console.log("This item is required and can't be removed from the cart."),new Promise(((t,e)=>{cancelled=!0,e(new Error("Can't remove this item from the cart."))}));var i=arguments,u=this;return(y=e.apply(u,i)).then((function(e){_(p.add,!1).then((function(e){h.promiseQueue.process(t),h.nav.isCartPage()&&h.nav.reload()}))})),y}}else if(p.remove.length>0)return i=arguments,u=this,(y=e.apply(u,i)).then((function(e){f(p.remove).then((function(e){h.promiseQueue.process(t),h.nav.isCartPage()&&h.nav.reload()}))})),y}else if(!1!==(n=r(arguments))){var p,y;if(m=!0,h.promiseQueue.add(t,(function(){return o()}),(function(){})),(p=d(n,!1,"add")).add.length>0)return i=arguments,u=this,_(p.add,!1).then((function(n){var a=e.apply(u,i);return p.remove.length>0?(a.then((function(e){f(p.remove).then((function(e){h.promiseQueue.process(t)}))})),a):(a.then((function(e){h.promiseQueue.process(t)})),a)}));if(p.remove.length>0)return i=arguments,u=this,(y=e.apply(u,i)).then((function(e){f(p.remove).then((function(e){h.promiseQueue.process(t)}))})),y;h.promiseQueue.add(t,(function(){return a(!1,"add")}),(function(){}))}}catch(t){console.log("Cartbot"),console.error(t)}return l(arguments)&&(m=!0,h.promiseQueue.add(t,(function(){return o()}),(function(){}))),(y=e.apply(this,arguments)).then((function(e){h.promiseQueue.process(t)})),y}}catch(t){console.log(t)}}(window),function(){try{document.addEventListener("click",(function(t){try{if(t.target.matches('form[action*="/cart/add"] .shopify-payment-button__button')||t.target.matches('form[action*="/cart/add"] .shopify-payment-button__button *')||t.target.matches('form[action*="/cart/add"] .shopify-payment-button__more-options')||t.target.matches('form[action*="/cart/add"] .lh-buy-now')){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var i=e(t.target,"form");if(null!==i){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var o=i.getAttribute("action"),l=new URLSearchParams,c=new FormData(i);for(var d of c)l.append(d[0],d[1]);var u=s(r([o,{body:l}]),!0,"add");o+="?cartbot-cart-call";var p="buy_now_queue";if(u.add.length>0){addingVariants=!0,h.promiseQueue.add(p,(function(){return _(u.add,!1)}),n)}else u.remove.length>0&&h.promiseQueue.add(p,(function(){return f(u.remove)}),n);h.promiseQueue.add(p,(function(){return fetch(o,{method:"post",body:l}).then((function(t){}))}),n),h.promiseQueue.add(p,(function(){return a(!0,"add")}),n),h.promiseQueue.process(p)}}}catch(t){console.log(t.message)}}),!0)}catch(t){console.log(t.message)}try{addEventListener("storage",(function(t){"string"==typeof t.key&&"cartbot_data_cart"===t.key&&h.cart.get(!1,!1)}))}catch(t){console.log(t.message)}}(),setTimeout((function(){!1===m?a(!1,""):console.log("Can't check for Cartbot actions because an action is already being processed")}),1e3),window.addEventListener("icartAddToCartEvent",(function(){console.log("Item added to the cart"),a(!1,"add")})),window.addEventListener("icartUpdateCartEvent",(function(){console.log("iCart updated"),a(!1,"")}))}}}();if(void 0===g)var g={};v.init()}()}()}