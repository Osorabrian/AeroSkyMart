var goodappswbaseUrl="https://wholesale.good-apps.co/";var goodappswApiUrl="https://wholesale.good-apps.co/";var goodappswShop="pilot-shop-nz.myshopify.com";var goodappswTriggerEvents=[6];var goodappswPageIds=[];var goodappswCertainBtns=[];var goodappswCurrencyCode="NZD";var goodappswCurrencySymbol="${{amount}}";var goodappswUrl=window.location.href;var goodappswVersion="3"
var goodappswShowPopupAllPeriod=0;var goodappswShowPopupPerDay=0;var goodappswWhenPopupDisplayed=0;var goodappswRemoveFunnelProducts=3;var goodappswMaxShowOffer=0;var goodappswTriggerButton="";var goodappswOrderTag="";var goodappswbuyItNow="";var goodappswCartButton="";var goodappswInlineWidget="";var goodappswInlineWidgetCartPage="";var goodappswInlineWidgetThankYouPage="";var goodappswInlineWidgetSelectedPage="";var goodappswCartSubtotal="";var goodappswCartSubtotalContainer="";var goodappswTikTok="";var goodappswPinterest="";var goodappswFacebook="";var goodappswSnapchat="";var goodappswSnapchatEmail="";var goodappswGoogle="";var goodappswTranslations={"en":{"checkout_btn":"Add to Cart","discount_tag_text":"Save","total_text":"Total:","most_popular_tag_text":"Most popular"}};var goodappswCartItemClass="";var goodappswCartItemPriceClass="";var goodappswProductPriceClass="";var goodappswProductQtyClass="";var goodappswProductVariantsClass="";if(!goodappswApp){var goodappswApp=function(){let currentProductId;let purchaseData=[];let orderData=[];let statisticArr=[];let iframe;let excludeOffers=[];let triggerProduct=false;let volumeOffer=null;const currentLocale=Shopify.locale;const appContainerClass='.goodappsw-app-container';let runUpdate=true;let dialCode='';let facebookId=goodappswFacebook||null;let googleId=goodappswGoogle||null;let pinterestId=goodappswPinterest||null;let snapId=goodappswSnapchat||null;let snapEmail=goodappswSnapchatEmail||null;let tikTokId=goodappswTikTok||null;const offerTypes={form:15,volumeDiscount:17,wholesale:18}
const triggerTypes={addToCart:'1',cartPage:'2',thankYouPage:'3',selectedPages:'4',certainButtons:'5',productPage:'6',exitIntent:'7',homePage:'8',collectionPage:'9',blogPage:'10',beforeCheckout:'11',buyItNow:'12'}
const popupTypes={popup:'1',float_popup:'2',inline:'3',not_display:'4',table:'5'}
const inlineWidgetPosition={before:'1',after:'2'}
const approvalType={manual:'1',auto:'2'}
if(Shopify.designMode){buildPreviewContainer();}
goodappswCurrencySymbol=decodeHTML(goodappswCurrencySymbol.replace(/(<([^>]+)>)/ig,""));const currentCurrencyCode=Shopify.currency.active;let currentCurrencySymbol=goodappswCurrencySymbol;let currencyRate=1;const country=Shopify.country;if(goodappswCurrencyCode!==currentCurrencyCode){currencyRate=Shopify.currency.rate;const regexStr=`[${getMainCurrencySymbol()}]`;const regex=new RegExp(regexStr,'g')
currentCurrencySymbol=goodappswCurrencySymbol.replace(regex,getCurrencySymbol(country,currentCurrencyCode));}
function getCurrencySymbol(locale,currency){return(0).toLocaleString(locale.toLowerCase(),{style:'currency',currency:currency,minimumFractionDigits:0,maximumFractionDigits:0}).replace(/\d/g,'').trim()}
function getMainCurrencySymbol(){if(goodappswCurrencySymbol.includes('{{')){return goodappswCurrencySymbol.replace(/{{(.*?)}}/ig,'').trim();}else{return goodappswCurrencySymbol.trim();}}
function getPriceByRate(price){return(parseFloat(price)*currencyRate).toFixed(2);}
function getStorePriceByRate(price){return(parseFloat(price)/ currencyRate).toFixed(2);}
function currencyFormat(num){if(currentCurrencySymbol.includes('{{')){return currentCurrencySymbol.replace(/{{(.*?)}}/ig,formatNumber(num));}else{return currentCurrencySymbol+formatNumber(num);}}
function formatNumber(num){num=parseFloat(num).toFixed(2);const locale=country==='US'?`en-${country}`:country.toLowerCase();return parseFloat(num).toLocaleString(locale,{style:'currency',currency:currentCurrencyCode,}).replace(/[^\d.,\.]/g,'')}
function decodeHTML(html){const txt=document.createElement('textarea');txt.innerHTML=html;return txt.value;};function setCookieData(){let url=location.href;const oneWeek=new Date(Date.now()+3600000*24*7);if(url.includes('#')){url=url.split('#');if(url[url.length-1]){let parameter='#'+url[url.length-1];setCookie('goodappswUrl',parameter,{expires:oneWeek});}}}
setCookieData();function setCookie(name,value,options={}){options={path:'/',...options};if(options.expires instanceof Date){options.expires=options.expires.toUTCString();}
let updatedCookie=encodeURIComponent(name)+"="+encodeURIComponent(value);for(let optionKey in options){updatedCookie+="; "+optionKey;let optionValue=options[optionKey];if(optionValue!==true){updatedCookie+="="+optionValue;}}
document.cookie=updatedCookie;}
function getCookie(name){let matches=document.cookie.match(new RegExp("(?:^|; )"+name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,'\\$1')+"=([^;]*)"));return matches?decodeURIComponent(matches[1]):undefined;}
function setContainerId(){return`goodappsw-app-${makeId(5)}`;}
function buildPopUpType(params){const{dataOffer,dataCart,currentProductId,triggerType,allVariantsId,currentProduct}=params;for(let key in dataOffer.offers){const offerItem=dataOffer.offers[key];const popUpType=(offerItem.popup_type).toString();switch(popUpType){case popupTypes.inline:case popupTypes.table:buildInlineWidget({dataOffer,offerItem,dataCart,currentProductId,triggerType,allVariantsId,currentProduct});break;case popupTypes.not_display:buildDisplayNoneWidget({dataOffer,offerItem,allVariantsId,currentProduct})
break;}}
socialPixel();}
function buildInlineWidget(params){const{offerItem,triggerType}=params;let rootId=setContainerId();let nodeElement=null;nodeElement=getInlineNode(triggerType);function getInlineNode(triggerType){let defaultNodeElements=[];let inlineWidgetArr=[];switch(triggerType){case triggerTypes.cartPage:defaultNodeElements=[appContainerClass,'cart-items','form[action*="/cart"]'];inlineWidgetArr=goodappswInlineWidgetCartPage.length?decodeHTML(goodappswInlineWidgetCartPage).split(','):inlineWidgetArr;break;case triggerTypes.productPage:defaultNodeElements=[appContainerClass,'form[action*="/cart/add"]'];inlineWidgetArr=goodappswInlineWidget.length?decodeHTML(goodappswInlineWidget).split(','):inlineWidgetArr;break;case triggerTypes.selectedPages:defaultNodeElements=[appContainerClass,'.goodappsw-container'];inlineWidgetArr=goodappswInlineWidgetSelectedPage.length?decodeHTML(goodappswInlineWidgetSelectedPage).split(','):inlineWidgetArr;break;case triggerTypes.thankYouPage:defaultNodeElements=[appContainerClass,'.section__header'];inlineWidgetArr=goodappswInlineWidgetThankYouPage.length?decodeHTML(goodappswInlineWidgetThankYouPage).split(','):inlineWidgetArr;break;}
const commonInlineWidgetArr=inlineWidgetArr.concat(defaultNodeElements);const uniqueInlineWidgetArr=[...new Set(commonInlineWidgetArr)];if(uniqueInlineWidgetArr.length){for(let i=0;i<uniqueInlineWidgetArr.length;i++){const itemTrim=uniqueInlineWidgetArr[i].trim();const currentNode=document.querySelector(itemTrim);if(currentNode!=null){return currentNode;}}}else{return null;}}
if(!nodeElement)return;const isSylesheet=document.querySelector('link#GoodAppsWholesaleCss');if(!isSylesheet){styleLoader();}
buildInlineContainer();function styleLoader(){const headID=document.getElementsByTagName('head')[0];const link=document.createElement('link');link.type='text/css';link.id='GoodAppsWholesaleCss';link.rel='stylesheet';headID.appendChild(link);link.href=goodappswbaseUrl+`css/goodapps-wholesale.css?v=${goodappswVersion}`;};function buildInlineContainer(){clearPreviewContainer();const insertPosition=(offerItem.inline_position).toString();const element=document.createElement("div");element.setAttribute("id",rootId);element.style.width='100%';element.style.margin='20px 0';element.style.fontFamily='inherit';element.style.display='none';if(insertPosition===inlineWidgetPosition.before){nodeElement.before(element);}else{nodeElement.after(element);}}
const offerType=offerItem.offer_type;switch(offerType){case offerTypes.volumeDiscount:case offerTypes.wholesale:buildVolumeDiscountInline({rootId,...params});break;case offerTypes.form:buildForm({rootId,...params});break;}}
function removeAppContainer(rootId){const appPopup=document.querySelector(`#${rootId}`);iframe=null;if(appPopup){appPopup.remove();}
document.querySelector('body').style.overflow='';document.querySelector('body').style.height='';document.querySelector('html').style.overflow='';document.querySelector('html').style.height='';}
function buildPreviewContainer(){const rootDiv=document.querySelector(appContainerClass);if(!rootDiv)return;const html='<span>The <b>GoodApps APP</b> will be displayed here!</span>';const element=document.createElement("div");element.classList.add('goodappsw-app-preview');element.style.padding='20px';element.style.border='1px solid #e4e4e4';element.style.borderRadius='8px';element.style.textAlign='center';element.innerHTML=html;rootDiv.append(element);}
function clearPreviewContainer(){const previewContainer=document.querySelector(appContainerClass);if(previewContainer){previewContainer.innerHTML='';}}
function getAppSelector(element,rootId){let rootNode=document.querySelector(`#${rootId}`);if(iframe){rootNode=iframe.contentWindow.document.querySelector(`#${rootId}`);}
return rootNode.querySelector(element);}
function getAppSelectorAll(element,rootId){let rootNode=document.querySelector(`#${rootId}`);if(iframe){rootNode=iframe.contentWindow.document.querySelector(`#${rootId}`);}
return rootNode.querySelectorAll(element);}
function buildVolumeDiscountInline(params){const{dataOffer,offerItem,currentProductId,rootId,triggerType,allVariantsId,currentProduct}=params;const offerObj={mainOfferId:offerItem.main_offer_id,offerId:offerItem.id,offerDesign:dataOffer.design[offerItem.id],allowPageReload:offerItem.reload_page?true:false,pageReload:false,currentTriggerType:triggerType,volumeId:makeId(5),hideVariationPrice:offerItem.hide_variation_price}
const offerTexts=getOfferTexts(dataOffer,offerItem)
const offerProduct=offerItem.products?offerItem.products[currentProductId]:null;const triggerProductData=dataOffer.products[currentProductId];const triggerVariants=getActiveVariants(triggerProductData.variants,offerProduct);const updatedTriggerVariants=checkSoldOutProduct(triggerVariants);if(!updatedTriggerVariants.length){return;}
triggerProductData.variants=updatedTriggerVariants;const copyright='';const html=`
                <div class="goodappsw-popup__body goodappsw-bd goodappsw-width-container">
                    <div class="goodappsw-popup__main goodappsw-bg-main">
                        <div class="goodappsw-countdown goodappsw-timer">
                            <div class="goodappsw-countdown__wrap">
                                <div class="goodappsw-countdown__msg goodappsw-timer-msg"></div>
                                <div class="goodappsw-countdown__time"></div>
                            </div>
                        </div>

                        <div class="goodappsw-popup__main--wrapper goodappsw-wallpaper"></div>

                        <div class="goodappsw-popup__heading goodappsw-bg-heading">
                            <h2 class="goodappsw-popup__title goodappsw-title"></h2>
                            <p class="goodappsw-popup__description goodappsw-description"></p>
                        </div>

                        <div class="goodappsw-popup__options"></div>

                        <div class="goodappsw-popup__buttons goodappsw-bg-bottom">
                            <a href="#" class="goodappsw-checkout-btn" data-checkout="${offerItem.checkout_btn_event}" data-redirect="${offerItem.specific_url}"></a>
                        </div>
                        ${copyright}
                    </div>
                </div>

                <style type="text/css" id="goodappsw-custom-css"></style>
            `;const element=document.createElement("div");element.classList.add("goodappsw-inline","goodappsw-volume");element.innerHTML=html;const rootDiv=document.getElementById(rootId);rootDiv.append(element);const timerData={minutes:offerObj.offerDesign.main.timer_min,seconds:offerObj.offerDesign.main.timer_sec,display:getAppSelector('.goodappsw-countdown__time',rootId),rootId,offerId:offerObj.offerId,mainOfferId:offerObj.mainOfferId,offerObj:offerObj}
buildTimer(timerData.minutes,timerData.seconds,timerData.display);const countDownTimer=new Timer(timerData);const volumeData=offerItem.volume_discount;const volumeDataOptions=volumeData.options;volumeDataOptions.forEach((option,i)=>{const productData={allow_highlight:volumeData.allow_highlight_option,highlight_option:volumeData.highlight_option,option_number:i+1,product:triggerProductData}
fillVolumeOption(option,productData,rootId,offerObj);})
setTranslation(rootId,dataOffer);buildWidget(offerObj.offerDesign,rootId,countDownTimer);changeWidgetText(element,offerTexts);addVolumeEvents({element,offerObj,rootId,countDownTimer,volumeDataOptions});volumeOffer={volumeDataOptions,offerObj,allVariantsId};showProductPageDiscount(triggerProductData,volumeDataOptions,currentProduct);setTimeout(()=>{rootDiv.style.display='block';},500);}
function buildDisplayNoneWidget(params){const{dataOffer,offerItem,allVariantsId,currentProduct}=params;const offerObj={mainOfferId:offerItem.main_offer_id,offerId:offerItem.id,volumeId:makeId(5)}
const offerProduct=offerItem.products?offerItem.products[currentProductId]:null;const triggerProductData=dataOffer.products[currentProductId];const triggerVariants=getActiveVariants(triggerProductData.variants,offerProduct);const updatedTriggerVariants=checkSoldOutProduct(triggerVariants);if(!updatedTriggerVariants.length){return;}
triggerProductData.variants=updatedTriggerVariants;const volumeDataOptions=offerItem.volume_discount.options;volumeOffer={volumeDataOptions,offerObj,allVariantsId};showProductPageDiscount(triggerProductData,volumeDataOptions,currentProduct);}
function setTranslation(rootId,dataOffer){const settingTexts=getSettingTexts(dataOffer)
const dataTranslation={"checkout-btn-text":{value:"checkout_btn",element:"goodappsw-checkout-btn"},"total-text":{value:"total_text",element:"goodappsw-total"},"discount-tag-text":{value:"discount_tag_text",element:"goodappsw-save"},"most-popular-tag-text":{value:"most_popular_tag_text",element:"goodappsw-save-label"},};for(let key in dataTranslation){const{value,element}=dataTranslation[key];const option=settingTexts[value];if(option==null)return;const nodeList=getAppSelectorAll('.'+element,rootId)
nodeList.forEach((node)=>{node.innerText=option;});}}
function getSettingTexts(dataOffer){const defaultLocale=dataOffer.current_lang;const defaultLang=goodappswTranslations[defaultLocale]||goodappswTranslations[Object.keys(goodappswTranslations)[0]];const currentLang=goodappswTranslations[currentLocale]||defaultLang;return{'checkout_btn':currentLang.checkout_btn||defaultLang.checkout_btn,'total_text':currentLang.total_text||defaultLang.total_text,'discount_tag_text':currentLang.discount_tag_text||defaultLang.discount_tag_text,'most_popular_tag_text':currentLang.most_popular_tag_text||defaultLang.most_popular_tag_text}}
function getOfferTexts(dataOffer,offerItem){const{translate}=offerItem;let data=translate[currentLocale]||offerItem;return{'title':data.title||offerItem.title,'allow_set_description':offerItem.allow_set_description,'description':data.description||offerItem.description,'timer_text':data.timer_text||offerItem.timer_text}}
function fillVolumeOption(optionData,productData,rootId,offerObj){const{custom_text,allow_range,range_from,range_to,discount_type,discount_value}=optionData;const{product,allow_highlight,highlight_option,option_number}=productData;const highlightLabel=allow_highlight&&+option_number===+highlight_option?`<div class="goodappsw-option__label goodappsw-save-label goodappsw-highlight"></div>`:'';let discountLabel='';let comparePrice='';let productPrice=product.variants[0].variantPrice;let compareTotalPrice=parseFloat(discount_value)?`<strike class="goodappsw-compare-price goodappsw-total-compare-price"></strike>`:'';if(parseFloat(discount_value)){const discount=discount_type==='%'?`${discount_value}${discount_type}`:currencyFormat(getPriceByRate(discount_value));discountLabel=`<p class="goodappsw-option__save-text goodappsw-discount-text"><span class="goodappsw-save"></span> ${discount}</p>`;comparePrice=`<strike class="goodappsw-compare-price">${currencyFormat(productPrice)}</strike>`;if(discount_type==='%'){productPrice=(+productPrice-(+productPrice*+discount_value / 100)).toFixed(2);}else{productPrice=(+productPrice- +discount_value).toFixed(2);}}
let optionHtml='';if(product.variants.length>1){let variantsHtml='';variantsHtml='<select class="goodappsw-variations">';for(let key in product.variants){if(product.variants.hasOwnProperty(key)){let variantPrice=product.variants[key]['variantPrice'];if(discount_value){if(discount_type==="%"){variantPrice=(variantPrice-(variantPrice*+discount_value / 100)).toFixed(2);}else{variantPrice=(+variantPrice- +discount_value).toFixed(2);}}
variantsHtml+=`
                        <option
                            value="${product.variants[key]['productId']}"
                            data-price-old="${getPriceByRate(product.variants[key]['variantPrice'])}"
                            data-price="${product.variants[key]['variantPrice']}"
                            data-store-price="${product.variants[key]['variantPrice']}"
                            data-discount-price="${variantPrice}"
                        >
                            ${product.variants[key]['title']} ${offerObj.hideVariationPrice ? '' : ' - ' + currencyFormat(variantPrice)}
                        </option>
                    `;}}
variantsHtml+='</select>';if(range_from>=1){for(let i=0;i<range_from;i++){optionHtml+=`
                            <div class="goodappsw-option__product">
                                <span class="goodappsw-option__number">#${i + 1}</span>

                                <div class="goodappsw-option__select">
                                    ${variantsHtml}
                                </div>
                            </div>
                        `;}}
if(range_to){optionHtml+=setPlusRow(range_from);}}else{optionHtml=setQtyRow(range_from,range_to,allow_range);}
function setPlusRow(range_from){return`
                    <div class="goodappsw-option__product">
                        <span class="goodappsw-option__number">#${+range_from + 1}</span>

                        <div class="goodappsw-option__plus goodappsw-variations">
                            <svg width="16" height="16" viewBox="0 0 14 14" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <rect x="6" width="2" height="14" rx="1" fill="currentColor"></rect>
                                <rect x="14" y="6" width="2" height="14" rx="1" transform="rotate(90 14 6)" fill="currentColor"></rect>
                            </svg>
                        </div>
                    </div>
                `}
function setQtyRow(range_from,range_to,allow_range){if(allow_range&&range_to){return`
                        <div class="goodappsw-option__product">
                            <div class="goodappsw-option__qty goodappsw-variations" data-max-qty="${range_to}">
                                <div class="goodappsw-option__qty-btn goodappsw-qty-btn goodappsw-qty-minus">-</div>
                                <input class="goodappsw-option__qty-input" type="number" value="${range_from}" min="${range_from}" max="${range_to}">
                                <div class="goodappsw-option__qty-btn goodappsw-qty-btn goodappsw-qty-plus">+</div>
                            </div>
                        </div>
                    `}else{return`<input type="hidden" class="goodappsw-option__qty-input" type="number" value="${range_from}" min="${range_from}">`}}
const html=`
                ${highlightLabel}

                <div class="goodappsw-option__content">
                    <div class="goodappsw-option__info">
                        <div class="goodappsw-option__radio goodappsw-radio-border">
                            <div class="goodappsw-option__radio-dot goodappsw-radio-bg"></div>
                        </div>

                        <p class="goodappsw-prod-title">${custom_text}</p>
                    </div>

                    <div class="goodappsw-option__result">
                        ${discountLabel}

                        <div class="goodappsw-option__price-block">
                            ${comparePrice}
                            <span class="goodappsw-price"
                                data-price-old="${getPriceByRate(product.variants[0].variantPrice)}"
                                data-price="${product.variants[0].variantPrice}"
                                data-discount-price="${productPrice}"
                                data-storePrice="${product.variants[0]['variantPrice']}"
                                data-productId="${product.variants[0]['productId']}"
                            >
                                ${currencyFormat(productPrice)}
                            </span>
                        </div>

                        <span class="goodappsw-option__total-block">
                            <span class="goodappsw-total"></span>
                            ${compareTotalPrice}
                            <span class="goodappsw-total-price"></span>
                        </span>
                    </div>
                </div>

                <div class="goodappsw-option__products" data-rangeto="${range_to ? range_to : null}">
                    ${optionHtml}
                </div>
            `;const element=document.createElement("div");element.classList.add("goodappsw-option","goodappsw-product-bg","goodappsw-product-border");element.setAttribute('data-discountType',discount_type)
element.setAttribute('data-discount',discount_value)
const activeOption=allow_highlight&&highlight_option?+highlight_option:1;if(option_number===activeOption){element.classList.add("goodappsw-bg-active");}
element.innerHTML=html;calcVolumeTotalOptionPrice(element);addVolumeRowEvents(element);const plusVariantBtn=element.querySelector('.goodappsw-option__plus');if(plusVariantBtn){addNewRowEvent(plusVariantBtn,element);}
const rootDiv=getAppSelector('.goodappsw-popup__options',rootId);rootDiv.append(element);}
function variantOptionEvent(variant,optionRow){variant.addEventListener('change',()=>{calcVolumeTotalOptionPrice(optionRow);setOptionPrice(optionRow);});}
function addVolumeRowEvents(optionRow){const variations=optionRow.querySelectorAll('select.goodappsw-variations');const qtyInput=optionRow.querySelector('.goodappsw-option__qty-input');const qtyPlusBtn=optionRow.querySelector('.goodappsw-qty-plus');const qtyMinusBtn=optionRow.querySelector('.goodappsw-qty-minus');if(variations.length){variations.forEach(variant=>{variantOptionEvent(variant,optionRow)});}
if(qtyInput&&qtyPlusBtn&&qtyMinusBtn){const maxVal=qtyInput.max;qtyPlusBtn.addEventListener('click',function(){changeQtyValue(qtyInput,'add',maxVal);calcVolumeTotalOptionPrice(optionRow);});qtyMinusBtn.addEventListener('click',function(){changeQtyValue(qtyInput,'sub',maxVal);calcVolumeTotalOptionPrice(optionRow);});qtyInput.addEventListener('change',function(){changeQtyValue(qtyInput,'change',maxVal);calcVolumeTotalOptionPrice(optionRow);})}}
function addVolumeEvents(params){const{element,offerObj,rootId,countDownTimer,volumeDataOptions}=params;const{mainOfferId,offerId,volumeId}=offerObj;const checkoutBtn=element.querySelector('.goodappsw-checkout-btn');const options=element.querySelectorAll('.goodappsw-option');checkoutBtn.addEventListener('click',function(event){event.preventDefault();const checkoutEvent=this.getAttribute('data-checkout');const redirectUrl=this.getAttribute('data-redirect');statisticArr.push(offerId);let productCount=0;const product=element.querySelector('.goodappsw-bg-active');const productVolumeData=getVolumeProducts(product);let activeProductsLength=+productVolumeData.length;element.querySelector('.goodappsw-popup__body').classList.add('goodappsw-preload');addVolumeProducts(productVolumeData);function addVolumeProducts(productVolumeData){if(!productVolumeData.length)return
productVolumeData.forEach((productItem,i)=>{setTimeout(()=>{const{propertyId,variantId,storePrice,discountType,discountValue,qty}=productItem;addItem(variantId,qty,{offer:propertyId}).then(()=>{createOrderData(variantId,propertyId,discountType,discountValue,qty);createPurchaseData(mainOfferId,offerId,variantId,propertyId,storePrice);createVolumeProductsData(volumeId,variantId,propertyId);productCount++
if(offerObj.allowPageReload){offerObj.pageReload=true;}
if(activeProductsLength===productCount){sendStatistic(mainOfferId,offerId,true);createVolumeData(volumeId,volumeDataOptions);setTimeout(()=>{element.querySelector('.goodappsw-popup__body').classList.remove('goodappsw-preload');checkoutBtnEvents(checkoutEvent,redirectUrl,rootId,offerObj,countDownTimer);},1500);}})},1000*i);});}});options.forEach(option=>{option.addEventListener('click',setActiveOption);})
function setActiveOption(e){e.preventDefault();if(!this.classList.contains('goodappsw-bg-active')){options.forEach(element=>element.classList.remove('goodappsw-bg-active'));this.classList.add('goodappsw-bg-active');removeDefaultColor(offerObj.offerDesign,rootId);changeActiveColor(offerObj.offerDesign,rootId);}}}
function getVolumeProducts(product){let productVolumeData=[];const variants=product.querySelectorAll('select.goodappsw-variations');if(variants.length){let uniqIds=[];variants.forEach(variantItem=>{const variantId=variantItem.selectedOptions[0].value;if(uniqIds.includes(variantId)){const targetElement=productVolumeData.find(el=>+el.variantId===+variantId);targetElement.qty=+targetElement.qty+1;}else{productVolumeData.push({propertyId:makeId(5),variantId,storePrice:variantItem.selectedOptions[0].getAttribute('data-store-price'),discountType:product.getAttribute('data-discountType'),discountValue:product.getAttribute('data-discount')||null,qty:1});uniqIds.push(variantId);}})}else{productVolumeData.push({propertyId:makeId(5),variantId:product.querySelector('.goodappsw-price').getAttribute('data-productId'),storePrice:product.querySelector('.goodappsw-price').getAttribute('data-storePrice'),discountType:product.getAttribute('data-discountType'),discountValue:product.getAttribute('data-discount')||null,qty:+product.querySelector('.goodappsw-option__qty-input').value})}
return productVolumeData;}
function createVolumeProductsData(volumeId,variantId,propertyId){if(!volumeId)return;const localVolumeData=localStorage.getItem('goodappswVolumeData');let volumeData=localVolumeData?JSON.parse(localVolumeData):[];let productData={volumeId:volumeId,volumeProducts:[],volumeOptions:[]}
if(volumeData.length){const checkVolumeId=volumeData.find(item=>item.volumeId===volumeId);if(checkVolumeId){setProductsData(checkVolumeId);}else{volumeData.push(productData);setProductsData(productData);}}else{volumeData.push(productData);setProductsData(productData);}
localStorage.setItem('goodappswVolumeData',JSON.stringify(volumeData));function setProductsData(data){data.volumeProducts.push({variantId:variantId,propertyId:propertyId})}}
function createVolumeData(volumeId,volumeDataOptions){if(!volumeId)return;const localVolumeData=localStorage.getItem('goodappswVolumeData');let volumeData=localVolumeData?JSON.parse(localVolumeData):[];if(volumeData.length){const checkVolumeId=volumeData.find(item=>item.volumeId===volumeId);if(checkVolumeId){volumeDataOptions.forEach((option,index)=>{const checkOptionId=checkVolumeId.volumeOptions.length&&checkVolumeId.volumeOptions.find(item=>item.id===index);if(!checkOptionId){const{range_from,allow_range,range_to,discount_type,discount_value}=option;checkVolumeId.volumeOptions.push({range_from,allow_range,range_to,discount_type,discount_value,id:index});}})}}
localStorage.setItem('goodappswVolumeData',JSON.stringify(volumeData));}
function calcVolumeTotalOptionPrice(optionRow){const comparePriceDiv=optionRow.querySelector('.goodappsw-total-compare-price');const totalPriceDiv=optionRow.querySelector('.goodappsw-total-price');const qtyInput=optionRow.querySelector('.goodappsw-option__qty-input');let totalPrice=0;let totalComparePrice=0;const variations=optionRow.querySelectorAll('select.goodappsw-variations');if(variations.length){variations.forEach(variant=>{const variantPrice=variant.selectedOptions[0].getAttribute('data-price');const variantDiscountPrice=variant.selectedOptions[0].getAttribute('data-discount-price');totalComparePrice+=+variantPrice;totalPrice+=+variantDiscountPrice;})}else{const productPrice=optionRow.querySelector('.goodappsw-price').getAttribute('data-price');const discountPrice=optionRow.querySelector('.goodappsw-price').getAttribute('data-discount-price');totalPrice=qtyInput?+discountPrice*+qtyInput.value:+discountPrice;totalComparePrice=qtyInput?+productPrice*+qtyInput.value:+productPrice;}
if(comparePriceDiv){comparePriceDiv.innerHTML=currencyFormat(totalComparePrice);}
totalPriceDiv.innerHTML=currencyFormat(totalPrice);}
function addNewRowEvent(btn,optionRow){btn.addEventListener('click',function(e){e.preventDefault();const self=this;buildVariantRow(optionRow,self);});}
function buildVariantRow(optionRow,self){const rangeTo=optionRow.querySelector('.goodappsw-option__products').getAttribute('data-rangeto');const products=optionRow.querySelectorAll('.goodappsw-option__product');const plusRowTempl=self.closest('.goodappsw-option__product').cloneNode(true);const selectTempl=self.closest('.goodappsw-option__products').querySelector('.goodappsw-option__select').cloneNode(true);const optionDiv=self.closest('.goodappsw-option__product');const variant=selectTempl.querySelector('select.goodappsw-variations');if(variant.length){variantOptionEvent(variant,optionRow);}
self.remove();optionDiv.append(selectTempl);calcVolumeTotalOptionPrice(optionRow);if(products.length<rangeTo){plusRowTempl.querySelector('.goodappsw-option__number').innerHTML=`#${products.length + 1}`;const btn=plusRowTempl.querySelector('.goodappsw-option__plus');addNewRowEvent(btn,optionRow);optionRow.querySelector('.goodappsw-option__products').append(plusRowTempl);}}
function setOptionPrice(optionRow){const priceBlock=optionRow.querySelector('.goodappsw-option__price-block');const comparePriceDiv=priceBlock.querySelector('.goodappsw-compare-price');const totalPriceDiv=priceBlock.querySelector('.goodappsw-price');const variations=optionRow.querySelectorAll('select.goodappsw-variations');const priceArr=[];let newPrice=0;let newComparePrice=0;variations.forEach(variant=>{const variantPrice=variant.selectedOptions[0].getAttribute('data-price');const variantDiscountPrice=variant.selectedOptions[0].getAttribute('data-discount-price');newPrice=+variantDiscountPrice;newComparePrice=+variantPrice;priceArr.push(+variantPrice)});const allEqual=priceArr.every(v=>v===priceArr[0]);if(allEqual){priceBlock.classList.remove('goodappsw-hide');totalPriceDiv.innerHTML=currencyFormat(newPrice);if(comparePriceDiv){comparePriceDiv.innerHTML=currencyFormat(newComparePrice);}}else{priceBlock.classList.add('goodappsw-hide');}}
function setActiveColor(widgetJson,rootId){const element=getAppSelector('.goodappsw-bg-active',rootId);const obj={"w-prod-bg":{cssOption:"background"},"w-border-color":{cssOption:"border-color"}}
let option=widgetJson.product.active_background;if(!option)return;for(let key in obj){let{cssOption}=obj[key];if(cssOption==='background'){option=convertHexToRGBA(option,0.1);}
element.style[cssOption]=option;}}
function changeActiveColor(widgetJson,rootId){const element=getAppSelector('.goodappsw-bg-active',rootId);let option=widgetJson.product.active_background;if(!option)return;const obj={"w-prod-bg":{cssOption:"background"},"w-border-color":{cssOption:"border-color"}}
for(let key in obj){let{cssOption}=obj[key];if(cssOption==='background'){option=convertHexToRGBA(option,0.1);}
element.style[cssOption]=option;}}
function removeDefaultColor(widgetJson,rootId){const obj={"w-prod-bg":{data:"product",value:"background",element:"goodappsw-product-bg",cssOption:"background"},"w-border-color":{data:"product",value:"prod_border_color",element:"goodappsw-product-border",cssOption:"border-color"}}
for(let key in obj){let{data,value,element,cssOption}=obj[key];const option=widgetJson[data][value];const elements=getAppSelectorAll('.'+element,rootId);elements.forEach((element)=>{element.style[cssOption]=option;})}}
function convertHexToRGBA(hexCode,opacity=1){let hex=hexCode.replace('#','');if(hex.length===3){hex=`${hex[0]}${hex[0]}${hex[1]}${hex[1]}${hex[2]}${hex[2]}`;}
const r=parseInt(hex.substring(0,2),16);const g=parseInt(hex.substring(2,4),16);const b=parseInt(hex.substring(4,6),16);if(opacity>1&&opacity<=100){opacity=opacity / 100;}
return`rgba(${r},${g},${b},${opacity})`;};function buildCopyright(){return'<div class="goodappsw-copyright"><a href="https://good-apps.co/" target="_blank">Powered by GoodApps</a></div>';}
function getActiveVariants(allVariants,activeVariants){const variants=[];for(let key in allVariants){if(activeVariants){if(activeVariants.includes(allVariants[key].productId)){variants.push(allVariants[key]);}}else{variants.push(allVariants[key]);}}
return variants;}
function checkSoldOutProduct(offerVariants){if(typeof(goodAppsData)!=='undefined'){const{product}=goodAppsData;if(!product){return offerVariants}
return offerVariants.filter(item=>{const targetVariant=product.variants.find(variantItem=>+variantItem.id===+item.productId);if(!targetVariant){return true;}
return targetVariant.available})}else{return offerVariants}}
function changeQtyValue(qty,type,maxVal){let currentQty=+qty.value;let minValue=+qty.getAttribute('min');let nextQty;switch(type){case'add':{if(maxVal){maxVal=+maxVal;nextQty=currentQty<maxVal?currentQty+1:maxVal;}else{nextQty=currentQty+1;}
break;}
case'sub':{currentQty===minValue?nextQty=minValue:nextQty=currentQty-1;break;}
case'change':{if(maxVal){maxVal=+maxVal;nextQty=currentQty<maxVal?currentQty:maxVal;}else{nextQty=currentQty;}
if(nextQty<=minValue||nextQty<=0){nextQty=minValue||1;}}}
qty.value=nextQty;}
function makeId(length){let result='';const characters='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';const charactersLength=characters.length;for(let i=0;i<length;i++){result+=characters.charAt(Math.floor(Math.random()*charactersLength));}
return result;}
function changeWidgetText(element,offerTexts){const titleRow=element.querySelector('.goodappsw-title');const descriptionRow=element.querySelector('.goodappsw-description');const timerRow=element.querySelector('.goodappsw-timer-msg');titleRow.innerText=offerTexts.title;if(offerTexts.allow_set_description){descriptionRow.classList.remove('goodappsw-hide');descriptionRow.innerText=offerTexts.description;}else{descriptionRow.classList.add('goodappsw-hide');}
timerRow.innerText=offerTexts.timer_text;}
window.addEventListener('resize',function(){const topSection=iframe?iframe.contentWindow.document.querySelector('.goodappsw-popup__top'):false;if(topSection){if(window.innerWidth<768){topSection.style.display="none";}else{topSection.style.display="flex";}}});function checkoutBtnEvents(val,customUrl,rootId,offerObj,countDownTimer){const goCheckout='1';const goCart='2';const goCustomUrl='3';const closePopUp='4';switch(val){case goCheckout:createOrder();break;case goCart:goToCart();break;case goCustomUrl:if(customUrl)location.href=`https://${customUrl}`;break;case closePopUp:closeModal('1',rootId,offerObj,countDownTimer);break;default:createOrder();break;}}
function closeModal(closeEvent='1',rootId,offerObj,countDownTimer){const goCheckout='2';const{mainOfferId,offerId}=offerObj;if(closeEvent===goCheckout){sendStatistic(mainOfferId,offerId);setTimeout(()=>{createOrder();},1000);}else{sendStatistic(mainOfferId,offerId);if(countDownTimer){countDownTimer.stopTimer()}
removeAppContainer(rootId);statisticArr.length=0;if(offerObj.pageReload){setTimeout(()=>{cartReload(offerObj);},1000);}}}
function buildWidget(dataOffer,rootId,countDownTimer){fillWidget(dataOffer,rootId,countDownTimer);fillWidgetSettings(dataOffer,rootId);}
const dataJsonMainSection={"goodappsw-bg-main":{data:"main",value:"background_main",input:"goodappsw-bg-main-input",element:"goodappsw-bg-main",cssOption:"background"},"goodappsw-bg-heading":{data:"main",value:"background_heading",element:"goodappsw-bg-heading",cssOption:"background"},"goodappsw-timer":{data:"main",value:"timer_bg",input:"goodappsw-timer-bg",element:"goodappsw-timer",cssOption:"background"},"goodappsw-timer-border-radius-left":{data:"main",value:"timer_border_radius",input:"goodappsw-timer-border-radius",element:"goodappsw-timer",cssOption:"border-bottom-left-radius",cssType:"size"},"goodappsw-timer-border-radius-right":{data:"main",value:"timer_border_radius",input:"goodappsw-timer-border-radius",element:"goodappsw-timer",cssOption:"border-bottom-right-radius",cssType:"size"},"goodappsw-timer-font-size":{data:"main",value:"timer_font_size",input:"goodappsw-timer-fs",element:"goodappsw-timer",cssOption:"font-size",cssType:"size"},"goodappsw-timer-color":{data:"main",value:"timer_color",input:"goodappsw-timer-color",element:"goodappsw-timer",cssOption:"color"},"goodappsw-timer-font-weight":{data:"main",value:"timer_font_weight",input:"goodappsw-timer-font-weight",element:"goodappsw-timer",cssOption:"font-weight"},"goodappsw-timer-font-style":{data:"main",value:"timer_font_style",input:"goodappsw-timer-font-style",element:"goodappsw-timer",cssOption:"font-style"},"goodappsw-timer-line-height":{data:"main",value:"timer_line_height",input:"goodappsw-timer-line-height",element:"goodappsw-timer",cssOption:"line-height",cssType:"size"},"goodappsw-title-font-size":{data:"main",value:"title_font_size",input:"goodappsw-title-fs",element:"goodappsw-title",cssOption:"font-size",cssType:"size"},"goodappsw-title-color":{data:"main",value:"title_color",input:"goodappsw-title-color",element:"goodappsw-title",cssOption:"color"},"goodappsw-title-font-weight":{data:"main",value:"title_font_weight",input:"goodappsw-title-font-weight",element:"goodappsw-title",cssOption:"font-weight"},"goodappsw-title-font-style":{data:"main",value:"title_font_style",input:"goodappsw-title-font-style",element:"goodappsw-title",cssOption:"font-style"},"goodappsw-title-line-height":{data:"main",value:"title_line_height",input:"goodappsw-title-line-height",element:"goodappsw-title",cssOption:"line-height",cssType:"size"},"goodappsw-description-font-size":{data:"main",value:"description_font_size",input:"goodappsw-description-fs",element:"goodappsw-description",cssOption:"font-size",cssType:"size"},"goodappsw-description-color":{data:"main",value:"description_color",input:"goodappsw-description-color",element:"goodappsw-description",cssOption:"color"},"goodappsw-description-font-weight":{data:"main",value:"description_font_weight",input:"goodappsw-description-font-weight",element:"goodappsw-description",cssOption:"font-weight"},"goodappsw-description-font-style":{data:"main",value:"description_font_style",input:"goodappsw-description-font-style",element:"goodappsw-description",cssOption:"font-style"},"goodappsw-description-line-height":{data:"main",value:"description_line_height",input:"goodappsw-description-line-height",element:"goodappsw-description",cssOption:"line-height",cssType:"size"},"goodappsw-border-width":{data:"main",value:"border_width",input:"goodappsw-border-size",element:"goodappsw-bd",cssOption:"border-width",cssType:"size"},"goodappsw-border-color":{data:"main",value:"border_color",input:"goodappsw-border-color",element:"goodappsw-bd",cssOption:"border-color"},"goodappsw-border-radius":{data:"main",value:"border_radius",input:"goodappsw-border-radius",element:"goodappsw-bd",cssOption:"border-radius",cssType:"size"},"goodappsw-border-radius-top":{data:"main",value:"border_radius",input:"w-border-radius",element:"goodappsw-bg-top",cssOption:"border-top-right-radius",cssType:"size"},"goodappsw-total-color":{data:"main",value:"total_color",input:"goodappsw-total-color",element:"goodappsw-total",cssOption:"color"},"goodappsw-total-font-size":{data:"main",value:"total_font_size",input:"goodappsw-total-font-size",element:"goodappsw-total",cssOption:"font-size",cssType:"size"},"goodappsw-total-font-weight":{data:"main",value:"total_font_weight",input:"goodappsw-total-font-weight",element:"goodappsw-total",cssOption:"font-weight"},"goodappsw-total-font-style":{data:"main",value:"total_font_style",input:"goodappsw-total-font-style",element:"goodappsw-total",cssOption:"font-style"},"goodappsw-total-line-height":{data:"main",value:"total_line_height",input:"goodappsw-total-line-height",element:"goodappsw-total",cssOption:"line-height",cssType:"size"},"goodappsw-total-price-color":{data:"main",value:"total_price_color",input:"goodappsw-total-price-color",element:"goodappsw-total-price",cssOption:"color"},"goodappsw-total-price-font-size":{data:"main",value:"total_price_font_size",input:"goodappsw-total-price-font-size",element:"goodappsw-total-price",cssOption:"font-size",cssType:"size"},"goodappsw-total-price-font-weight":{data:"main",value:"total_price_font_weight",input:"goodappsw-total-price-font-weight",element:"goodappsw-total-price",cssOption:"font-weight"},"goodappsw-total-price-font-style":{data:"main",value:"total_price_font_style",input:"goodappsw-total-price-font-style",element:"goodappsw-total-price",cssOption:"font-style"},"goodappsw-total-price-line-height":{data:"main",value:"total_price_line_height",input:"goodappsw-total-price-line-height",element:"goodappsw-total-price",cssOption:"line-height",cssType:"size"},"goodappsw-product-name-color":{data:"main",value:"product_name_color",element:"goodappsw-product-name",cssOption:"color"},"goodappsw-product-name-font-size":{data:"main",value:"product_name_font_size",element:"goodappsw-product-name",cssOption:"font-size",cssType:"size"},"goodappsw-product-name-font-weight":{data:"main",value:"product_name_font_weight",element:"goodappsw-product-name",cssOption:"font-weight"},"goodappsw-product-name-font-style":{data:"main",value:"product_name_font_style",element:"goodappsw-product-name",cssOption:"font-style"},"goodappsw-product-name-line-height":{data:"main",value:"product_name_line_height",element:"goodappsw-product-name",cssOption:"line-height",cssType:"size"},"goodappsw-product-price-color":{data:"main",value:"product_price_color",element:"goodappsw-product-price",cssOption:"color"},"goodappsw-product-price-font-size":{data:"main",value:"product_price_font_size",element:"goodappsw-product-price",cssOption:"font-size",cssType:"size"},"goodappsw-product-price-font-weight":{data:"main",value:"product_price_font_weight",element:"goodappsw-product-price",cssOption:"font-weight"},"goodappsw-product-price-font-style":{data:"main",value:"product_price_font_style",element:"goodappsw-product-price",cssOption:"font-style"},"goodappsw-product-price-line-height":{data:"main",value:"product_price_line_height",element:"goodappsw-product-price",cssOption:"line-height",cssType:"size"}};const dataJsonBottomSection={"goodappsw-background-bottom":{data:"bottom",value:"background_bottom",input:"goodappsw-bg-bottom-input",element:"goodappsw-bg-bottom",cssOption:"background"},"goodappsw-reject-btn-bd-radius":{data:"bottom",value:"reject_btn_border_radius",input:"goodappsw-reject-btn-bd-radius",element:"goodappsw-reject-btn",cssOption:"border-radius",cssType:"size"},"goodappsw-reject-btn-font-size":{data:"bottom",value:"reject_btn_font_size",input:"goodappsw-reject-btn-font-size",element:"goodappsw-reject-btn",cssOption:"font-size",cssType:"size"},"goodappsw-reject-btn-font-weight":{data:"bottom",value:"reject_btn_font_weight",input:"goodappsw-reject-btn-font-weight",element:"goodappsw-reject-btn",cssOption:"font-weight"},"goodappsw-reject-btn-font-style":{data:"bottom",value:"reject_btn_font_style",input:"goodappsw-reject-btn-font-style",element:"goodappsw-reject-btn",cssOption:"font-style"},"goodappsw-reject-btn-line-height":{data:"bottom",value:"reject_btn_line_height",input:"goodappsw-reject-btn-line-height",element:"goodappsw-reject-btn",cssOption:"line-height",cssType:"size"},"goodappsw-reject-btn-padding-top":{data:"bottom",value:"reject_btn_padding_t_b",input:"goodappsw-reject-btn-padding-t-b",element:"goodappsw-reject-btn",cssOption:"padding-top",cssType:"size"},"goodappsw-reject-btn-padding-bottom":{data:"bottom",value:"reject_btn_padding_t_b",input:"goodappsw-reject-btn-padding-t-b",element:"goodappsw-reject-btn",cssOption:"padding-bottom",cssType:"size"},"goodappsw-reject-btn-padding-left":{data:"bottom",value:"reject_btn_padding_l_r",input:"goodappsw-reject-btn-padding-l-r",element:"goodappsw-reject-btn",cssOption:"padding-left",cssType:"size"},"goodappsw-reject-btn-padding-right":{data:"bottom",value:"reject_btn_padding_l_r",input:"goodappsw-reject-btn-padding-l-r",element:"goodappsw-reject-btn",cssOption:"padding-right",cssType:"size"},"goodappsw-checkout-btn-bd-radius":{data:"bottom",value:"checkout_btn_border_radius",input:"goodappsw-checkout-btn-bd-radius",element:"goodappsw-checkout-btn",cssOption:"border-radius",cssType:"size"},"goodappsw-checkout-btn-font-size":{data:"bottom",value:"checkout_btn_font_size",input:"goodappsw-checkout-btn-font-size",element:"goodappsw-checkout-btn",cssOption:"font-size",cssType:"size"},"goodappsw-checkout-btn-font-weight":{data:"bottom",value:"checkout_btn_font_weight",input:"goodappsw-checkout-btn-font-weight",element:"goodappsw-checkout-btn",cssOption:"font-weight"},"goodappsw-checkout-btn-font-style":{data:"bottom",value:"checkout_btn_font_style",input:"goodappsw-checkout-btn-font-style",element:"goodappsw-checkout-btn",cssOption:"font-style"},"goodappsw-checkout-btn-line-height":{data:"bottom",value:"checkout_btn_line_height",input:"goodappsw-checkout-btn-line-height",element:"goodappsw-checkout-btn",cssOption:"line-height",cssType:"size"},"goodappsw-checkout-btn-padding-top":{data:"bottom",value:"checkout_btn_padding_t_b",input:"goodappsw-checkout-btn-padding-t-b",element:"goodappsw-checkout-btn",cssOption:"padding-top",cssType:"size"},"goodappsw-checkout-btn-padding-bottom":{data:"bottom",value:"checkout_btn_padding_t_b",input:"goodappsw-checkout-btn-padding-t-b",element:"goodappsw-checkout-btn",cssOption:"padding-bottom",cssType:"size"},"goodappsw-checkout-btn-padding-left":{data:"bottom",value:"checkout_btn_padding_l_r",input:"goodappsw-checkout-btn-padding-l-r",element:"goodappsw-checkout-btn",cssOption:"padding-left",cssType:"size"},"goodappsw-checkout-btn-padding-right":{data:"bottom",value:"checkout_btn_padding_l_r",input:"goodappsw-checkout-btn-padding-l-r",element:"goodappsw-checkout-btn",cssOption:"padding-right",cssType:"size"}};const dataJsonBtnStyle={"goodappsw-reject-btn-bg":{data:"bottom",value:"reject_btn_bg",secondValue:"reject_btn_bg_hover",input:"goodappsw-reject-btn-bg",inputHover:"goodappsw-reject-btn-bg-h",element:"goodappsw-reject-btn",cssOption:"background"},"goodappsw-reject-btn-color":{data:"bottom",value:"reject_btn_font_color",secondValue:"reject_btn_font_color_hover",input:"goodappsw-reject-btn-color",inputHover:"goodappsw-reject-btn-color-h",element:"goodappsw-reject-btn",cssOption:"color"},"goodappsw-reject-btn-color-icon":{data:"bottom",value:"reject_btn_font_color",secondValue:"reject_btn_font_color_hover",input:"goodappsw-reject-btn-color",inputHover:"goodappsw-reject-btn-color-h",element:"goodappsw-reject-btn",cssOption:"fill"},"goodappsw-checkout-btn-bg":{data:"bottom",value:"checkout_btn_bg",secondValue:"checkout_btn_bg_hover",input:"goodappsw-checkout-btn-bg",inputHover:"goodappsw-checkout-btn-bg-h",element:"goodappsw-checkout-btn",cssOption:"background"},"goodappsw-checkout-btn-color":{data:"bottom",value:"checkout_btn_font_color",secondValue:"checkout_btn_font_color_hover",input:"goodappsw-checkout-btn-color",inputHover:"goodappsw-checkout-btn-color-h",element:"goodappsw-checkout-btn",cssOption:"color"},"goodappsw-close-bg-color":{data:"top",value:"close_bg_color",secondValue:"close_bg_color_hover",input:"goodappsw-close-bg-color",inputHover:"goodappsw-close-bg-color-h",element:"goodappsw-close",cssOption:"background"},"goodappsw-close-color":{data:"top",value:"close_color",secondValue:"close_color_hover",input:"goodappsw-close-color",inputHover:"goodappsw-close-color-h",element:"goodappsw-close",cssOption:"color"},"goodappsw-cart-btn-bg":{data:"product",value:"cart_btn_bg",secondValue:"cart_btn_bg_hover",input:"goodappsw-cart-btn-bg",inputHover:"goodappsw-cart-btn-bg-h",element:"goodappsw-cart-btn",cssOption:"background"},"goodappsw-cart-btn-color":{data:"product",value:"cart_btn_font_color",secondValue:"cart_btn_font_color_hover",input:"goodappsw-cart-btn-color",inputHover:"goodappsw-cart-btn-color-h",element:"goodappsw-cart-btn",cssOption:"color"},"goodappsw-cart-btn-color-icon":{data:"product",value:"cart_btn_font_color",secondValue:"cart_btn_font_color_hover",input:"goodappsw-cart-btn-color",inputHover:"goodappsw-cart-btn-color-h",element:"goodappsw-cart-btn",cssOption:"fill"},"goodappsw-qty-btn-bg":{data:"product",value:"qty_btn_bg",secondValue:"qty_btn_bg_hover",input:"goodappsw-qty-btn-bg",inputHover:"goodappsw-qty-btn-bg-h",element:"goodappsw-qty-btn",cssOption:"background"},"goodappsw-qty-btn-color":{data:"product",value:"qty_btn_color",secondValue:"qty_btn_color_hover",input:"goodappsw-qty-btn-color",inputHover:"goodappsw-qty-btn-color-h",element:"goodappsw-qty-btn",cssOption:"color"},"goodappsw-remove-btn-bg":{data:"product",value:"remove_btn_bg",secondValue:"remove_btn_bg_hover",element:"goodappsw-remove-btn",cssOption:"background"},"goodappsw-remove-btn-color":{data:"product",value:"remove_btn_font_color",secondValue:"remove_btn_font_color_hover",element:"goodappsw-remove-btn",cssOption:"color"},"goodappsw-remove-btn-color-icon":{data:"product",value:"remove_btn_font_color",secondValue:"remove_btn_font_color_hover",element:"goodappsw-remove-btn",cssOption:"fill"}};const dataJsonProductStyle={"goodappsw-prod-bg-img":{data:"product",value:"background_img",input:"goodappsw-prod-bg-img",element:"goodappsw-product-item",cssOption:"background"},"goodappsw-prod-bg":{data:"product",value:"background",input:"goodappsw-prod-bg",element:"goodappsw-product-bg",cssOption:"background"},"goodappsw-cart-btn-bd-radius":{data:"product",value:"cart_btn_border_radius",input:"goodappsw-cart-btn-radius",element:"goodappsw-cart-btn",cssOption:"border-radius",cssType:"size"},"goodappsw-cart-btn-font-size":{data:"product",value:"cart_btn_font_size",input:"goodappsw-cart-btn-font-size",element:"goodappsw-cart-btn",cssOption:"font-size",cssType:"size"},"goodappsw-cart-btn-font-weight":{data:"product",value:"cart_btn_font_weight",input:"goodappsw-cart-btn-font-weight",element:"goodappsw-cart-btn",cssOption:"font-weight"},"goodappsw-cart-btn-font-style":{data:"product",value:"cart_btn_font_style",input:"goodappsw-cart-btn-font-style",element:"goodappsw-cart-btn",cssOption:"font-style"},"goodappsw-cart-btn-line-height":{data:"product",value:"cart_btn_line_height",input:"goodappsw-cart-btn-line-height",element:"goodappsw-cart-btn",cssOption:"line-height",cssType:"size"},"goodappsw-cart-btn-padding-top":{data:"product",value:"cart_btn_padding_t_b",input:"goodappsw-cart-btn-padding-t-b",element:"goodappsw-cart-btn",cssOption:"padding-top",cssType:"size"},"goodappsw-cart-btn-padding-bottom":{data:"product",value:"cart_btn_padding_t_b",input:"goodappsw-cart-btn-padding-t-b",element:"goodappsw-cart-btn",cssOption:"padding-bottom",cssType:"size"},"goodappsw-cart-btn-padding-left":{data:"product",value:"cart_btn_padding_l_r",input:"goodappsw-cart-btn-padding-l-r",element:"goodappsw-cart-btn",cssOption:"padding-left",cssType:"size"},"goodappsw-cart-btn-padding-right":{data:"product",value:"cart_btn_padding_l_r",input:"goodappsw-cart-btn-padding-l-r",element:"goodappsw-cart-btn",cssOption:"padding-right",cssType:"size"},"goodappsw-remove-btn-bd-radius":{data:"product",value:"remove_btn_border_radius",element:"goodappsw-remove-btn",cssOption:"border-radius",cssType:"size"},"goodappsw-remove-btn-font-size":{data:"product",value:"remove_btn_font_size",element:"goodappsw-remove-btn",cssOption:"font-size",cssType:"size"},"goodappsw-remove-btn-font-weight":{data:"product",value:"remove_btn_font_weight",element:"goodappsw-remove-btn",cssOption:"font-weight"},"goodappsw-remove-btn-font-style":{data:"product",value:"remove_btn_font_style",element:"goodappsw-remove-btn",cssOption:"font-style"},"goodappsw-remove-btn-line-height":{data:"product",value:"remove_btn_line_height",element:"goodappsw-remove-btn",cssOption:"line-height",cssType:"size"},"goodappsw-remove-btn-padding-top":{data:"product",value:"remove_btn_padding_t_b",element:"goodappsw-remove-btn",cssOption:"padding-top",cssType:"size"},"goodappsw-remove-btn-padding-bottom":{data:"product",value:"remove_btn_padding_t_b",element:"goodappsw-remove-btn",cssOption:"padding-bottom",cssType:"size"},"goodappsw-remove-btn-padding-left":{data:"product",value:"remove_btn_padding_l_r",element:"goodappsw-remove-btn",cssOption:"padding-left",cssType:"size"},"goodappsw-remove-btn-padding-right":{data:"product",value:"remove_btn_padding_l_r",element:"goodappsw-remove-btn",cssOption:"padding-right",cssType:"size"},"goodappsw-cart-border-width":{data:"product",value:"prod_border_width",input:"goodappsw-cart-border-size",element:"goodappsw-product-border",cssOption:"border-width",cssType:"size"},"goodappsw-cart-border-color":{data:"product",value:"prod_border_color",input:"goodappsw-cart-border-color",element:"goodappsw-product-border",cssOption:"border-color"},"goodappsw-cart-border-radius":{data:"product",value:"prod_border_radius",input:"goodappsw-cart-border-radius",element:"goodappsw-product-border",cssOption:"border-radius",cssType:"size"},"goodappsw-prod-title-color":{data:"product",value:"prod_title_color",input:"goodappsw-prod-title-color",element:"goodappsw-prod-title",cssOption:"color"},"goodappsw-prod-title-font-size":{data:"product",value:"prod_title_font_size",input:"goodappsw-prod-title-font-size",element:"goodappsw-prod-title",cssOption:"font-size",cssType:"size"},"goodappsw-prod-title-font-weight":{data:"product",value:"prod_title_font_weight",input:"goodappsw-prod-title-font-weight",element:"goodappsw-prod-title",cssOption:"font-weight"},"goodappsw-prod-title-font-style":{data:"product",value:"prod_title_font_style",input:"goodappsw-prod-title-font-style",element:"goodappsw-prod-title",cssOption:"font-style"},"goodappsw-prod-title-line-height":{data:"product",value:"prod_title_line_height",input:"goodappsw-prod-title-line-height",element:"goodappsw-prod-title",cssOption:"line-height",cssType:"size"},"goodappsw-prod-desc-color":{data:"product",value:"prod_desc_color",input:"goodappsw-prod-desc-color",element:"goodappsw-prod-desc",cssOption:"color"},"goodappsw-prod-desc-font-size":{data:"product",value:"prod_desc_font_size",input:"goodappsw-prod-desc-font-size",element:"goodappsw-prod-desc",cssOption:"font-size",cssType:"size"},"goodappsw-prod-desc-font-weight":{data:"product",value:"prod_desc_font_weight",input:"goodappsw-prod-desc-font-weight",element:"goodappsw-prod-desc",cssOption:"font-weight"},"goodappsw-prod-desc-font-style":{data:"product",value:"prod_desc_font_style",input:"goodappsw-prod-desc-font-style",element:"goodappsw-prod-desc",cssOption:"font-style"},"goodappsw-prod-desc-line-height":{data:"product",value:"prod_desc_line_height",input:"goodappsw-prod-desc-line-height",element:"goodappsw-prod-desc",cssOption:"line-height",cssType:"size"},"goodappsw-qty-background":{data:"product",value:"qty_background",input:"goodappsw-qty-bg",element:"goodappsw-qty-input",cssOption:"background"},"goodappsw-qty-border":{data:"product",value:"qty_btn_bg",input:"goodappsw-qty-btn-bg",element:"goodappsw-qty-input",cssOption:"border-color"},"goodappsw-qty-color":{data:"product",value:"qty_font_color",input:"goodappsw-qty-color",element:"goodappsw-qty-input",cssOption:"color"},"goodappsw-qty-border-radius-top":{data:"product",value:"qty_border_radius",input:"goodappsw-qty-border-radius",element:"goodappsw-qty-input",cssOption:"border-top-left-radius",cssType:"size"},"goodappsw-qty-border-radius-bottom":{data:"product",value:"qty_border_radius",input:"goodappsw-qty-border-radius",element:"goodappsw-qty-input",cssOption:"border-bottom-left-radius",cssType:"size"},"goodappsw-qty-border-radius-btn-top":{data:"product",value:"qty_border_radius",input:"goodappsw-qty-border-radius",element:"goodappsw-qty-btn-t",cssOption:"border-top-right-radius",cssType:"size"},"goodappsw-qty-border-radius-btn-bottom":{data:"product",value:"qty_border_radius",input:"goodappsw-qty-border-radius",element:"goodappsw-qty-btn-b",cssOption:"border-bottom-right-radius",cssType:"size"},"goodappsw-price-color":{data:"product",value:"price_color",input:"goodappsw-price-color",element:"goodappsw-price",cssOption:"color"},"goodappsw-price-font-size":{data:"product",value:"price_font_size",input:"goodappsw-price-font-size",element:"goodappsw-price",cssOption:"font-size",cssType:"size"},"goodappsw-price-font-weight":{data:"product",value:"price_font_weight",input:"goodappsw-price-font-weight",element:"goodappsw-price",cssOption:"font-weight"},"goodappsw-price-font-style":{data:"product",value:"price_font_style",input:"goodappsw-price-font-style",element:"goodappsw-price",cssOption:"font-style"},"goodappsw-price-line-height":{data:"product",value:"price_line_height",input:"goodappsw-price-line-height",element:"goodappsw-price",cssOption:"line-height",cssType:"size"},"goodappsw-compare-price-color":{data:"product",value:"compare_price_color",input:"goodappsw-compare-price-color",element:"goodappsw-compare-price",cssOption:"color"},"goodappsw-compare-price-font-size":{data:"product",value:"compare_price_font_size",input:"goodappsw-compare-price-font-size",element:"goodappsw-compare-price",cssOption:"font-size",cssType:"size"},"goodappsw-compare-price-font-weight":{data:"product",value:"compare_price_font_weight",input:"goodappsw-compare-price-font-weight",element:"goodappsw-compare-price",cssOption:"font-weight"},"goodappsw-compare-price-font-style":{data:"product",value:"compare_price_font_style",input:"goodappsw-compare-price-font-style",element:"goodappsw-compare-price",cssOption:"font-style"},"goodappsw-compare-price-line-height":{data:"product",value:"compare_price_line_height",input:"goodappsw-compare-price-line-height",element:"goodappsw-compare-price",cssOption:"line-height",cssType:"size"},"goodappsw-save-background-color":{data:"product",value:"save_bg",input:"goodappsw-save-bg",element:"goodappsw-save-label",cssOption:"background"},"goodappsw-save-border-radius":{data:"product",value:"save_border_radius",input:"goodappsw-save-border-radius",element:"goodappsw-save-label",cssOption:"border-radius",cssType:"size"},"goodappsw-save-color":{data:"product",value:"save_color",input:"goodappsw-save-color",element:"goodappsw-save-label",cssOption:"color"},"goodappsw-save-font-size":{data:"product",value:"save_font_size",input:"goodappsw-save-font-size",element:"goodappsw-save-label",cssOption:"font-size",cssType:"size"},"goodappsw-save-font-weight":{data:"product",value:"save_font_weight",input:"goodappsw-save-font-weight",element:"goodappsw-save-label",cssOption:"font-weight"},"goodappsw-save-font-style":{data:"product",value:"save_font_style",input:"goodappsw-save-font-style",element:"goodappsw-save-label",cssOption:"font-style"},"goodappsw-save-line-height":{data:"product",value:"save_line_height",input:"goodappsw-save-line-height",element:"goodappsw-save-label",cssOption:"line-height",cssType:"size"},"goodappsw-save-padding":{data:"product",value:"save_padding",input:"goodappsw-save-padding",element:"goodappsw-save-label",cssOption:"padding",cssType:"size"},"goodappsw-variations-bg":{data:"product",value:"variations_background",input:"goodappsw-variations-bg",element:"goodappsw-variations",cssOption:"background-color"},"goodappsw-variations-color":{data:"product",value:"variations_font_color",input:"goodappsw-variations-color",element:"goodappsw-variations",cssOption:"color"},"goodappsw-variations-border-widrh":{data:"product",value:"variations_border_width",input:"goodappsw-variations-border-size",element:"goodappsw-variations",cssOption:"border-width",cssType:"size"},"goodappsw-variations-border-color":{data:"product",value:"variations_border_color",input:"goodappsw-variations-border-color",element:"goodappsw-variations",cssOption:"border-color",},"goodappsw-variations-border-radius":{data:"product",value:"variations_border_radius",input:"goodappsw-variations-border-radius",element:"goodappsw-variations",cssOption:"border-radius",cssType:"size"},"goodappsw-discount-text-color":{data:"product",value:"discount_text_color",element:"goodappsw-discount-text",cssOption:"color"},"goodappsw-discount-text-font-size":{data:"product",value:"discount_text_font_size",element:"goodappsw-discount-text",cssOption:"font-size",cssType:"size"},"goodappsw-discount-text-font-weight":{data:"product",value:"discount_text_font_weight",element:"goodappsw-discount-text",cssOption:"font-weight"},"goodappsw-discount-text-font-style":{data:"product",value:"discount_text_font_style",element:"goodappsw-discount-text",cssOption:"font-style"},"goodappsw-discount-text-line-height":{data:"product",value:"discount_text_line_height",element:"goodappsw-discount-text",cssOption:"line-height",cssType:"size"},"goodappsw-radio-bg":{data:"product",value:"radio_btn_bg",element:"goodappsw-radio-bg",cssOption:"background-color"},"goodappsw-radio-border":{data:"product",value:"radio_btn_bg",element:"goodappsw-radio-border",cssOption:"border-color"},"goodappsw-border-active":{data:"product",value:"active_background",element:"goodappsw-bg-active",cssOption:"border-color"}};const dataShowHide={"goodappsw-close":{data:"top",value:"close_show",input:"goodappsw-close-show",element:"goodappsw-close"},"goodappsw-alert-text":{data:"top",value:"alert_text_show",input:"goodappsw-alert-text-show",element:"goodappsw-alert-text"},"goodappsw-alert-prod":{data:"top",value:"alert_prod_show",input:"goodappsw-alert-prod-show",element:"goodappsw-alert-prod"},"goodappsw-alert-prod-img":{data:"top",value:"alert_prod_show",input:"goodappsw-alert-prod-show",element:"goodappsw-popup__cart-alert--img"},"goodappsw-timer":{data:"main",value:"timer_show",input:"goodappsw-timer-show",element:"goodappsw-timer"},"goodappsw-title":{data:"main",value:"title_show",input:"goodappsw-title-show",element:"goodappsw-title"},"goodappsw-description":{data:"main",value:"description_show",input:"goodappsw-description-show",element:"goodappsw-description"},"goodappsw-total":{data:"main",value:"total_show",input:"goodappsw-total-show",element:"goodappsw-total"},"goodappsw-total-price":{data:"main",value:"total_price_show",input:"goodappsw-total-price-show",element:"goodappsw-total-price"},"goodappsw-reject-btn":{data:"bottom",value:"reject_btn_show",input:"goodappsw-reject-btn-show",element:"goodappsw-reject-btn"},"goodappsw-checkout-btn":{data:"bottom",value:"checkout_btn_show",input:"goodappsw-checkout-btn-show",element:"goodappsw-checkout-btn"},"goodappsw-prod-title":{data:"product",value:"prod_title_show",input:"goodappsw-prod-title-show",element:"goodappsw-prod-title"},"goodappsw-prod-desc":{data:"product",value:"prod_desc_show",input:"goodappsw-prod-desc-show",element:"goodappsw-prod-desc"},"goodappsw-price":{data:"product",value:"price_show",input:"goodappsw-price-show",element:"goodappsw-price"},"goodappsw-compare-price":{data:"product",value:"compare_price_show",input:"goodappsw-compare-price-show",element:"goodappsw-compare-price"},"goodappsw-save":{data:"product",value:"save_show",input:"goodappsw-save-show",element:"goodappsw-save-label"},"goodappsw-qty":{data:"product",value:"qty_show",input:"goodappsw-qty-show",element:"goodappsw-qty"},"goodappsw-variations":{data:"product",value:"variations_show",input:"goodappsw-variations-show",element:"goodappsw-variations-wrap"},"goodappsw-top-show":{data:"top",value:"top_show",input:"goodappsw-top-show",element:"goodappsw-bg-top"},"goodappsw-discount-text-show":{data:"product",value:"discount_text_show",element:"goodappsw-discount-text"},"goodappsw-radio-show":{data:"product",value:"radio_show",element:"goodappsw-option__radio"},"goodappsw-bottom-show":{data:"bottom",value:"bottom_show",element:"goodappsw-bg-bottom"}};function fillWidget(widgetJson,rootId,countDownTimer){getObjJsonKeys(rootId,widgetJson,dataJsonMainSection);getObjJsonKeys(rootId,widgetJson,dataJsonBottomSection);getObjJsonKeys(rootId,widgetJson,dataJsonProductStyle);getObjJsonKeys(rootId,widgetJson,dataJsonBtnStyle,"btn");getObjJsonKeys(rootId,widgetJson,dataShowHide,"show");setActiveColor(widgetJson,rootId);const timerShow=widgetJson.main.timer_show;if(timerShow){countDownTimer.startTimer();}
const wallpaper=widgetJson.main.wallpaper;const wallpaperDiv=getAppSelector('.goodappsw-wallpaper',rootId);let wallpaperVal;if(wallpaper==='wallpaper_0'){wallpaperVal='transparent';}else{const coverWallpaper=['wallpaper_20','wallpaper_21','wallpaper_22','wallpaper_23','wallpaper_24','wallpaper_25','wallpaper_26'];if(coverWallpaper.includes(wallpaper)){wallpaperDiv.classList.add('cover');}else{wallpaperDiv.classList.remove('cover');}
wallpaperVal=`url("${goodappswbaseUrl}assets/images/widgets/wallpapers/${wallpaper}.png")`;}
wallpaperDiv.style.background=wallpaperVal;const custom_css=widgetJson.custom_css;const customCssDiv=getAppSelector('#goodappsw-custom-css',rootId);if(custom_css){customCssDiv.innerText=custom_css.replace(/.goodappsw-/g,`#${rootId} .goodappsw-`);}else{customCssDiv.innerText='';}
const prodDesc=getAppSelectorAll('.goodappsw-desc-short',rootId);prodDesc.forEach((element)=>{let str=element.innerText.trim();if(str.length>100){let trimmedStr=str.substring(0,100)+"...";element.innerText=trimmedStr;}});}
function fillWidgetSettings(widgetJson,rootId){const appBody=getAppSelector('.goodappsw-popup__body',rootId);const widgetWidth=widgetJson.design_type.widget_width;appBody.classList.remove('goodappsw-width-container','goodappsw-width-full');appBody.classList.add(`goodappsw-width-${widgetWidth}`);}
function getObjJsonKeys(rootId,widgetJson,obj,type){for(let key in obj){if(type==="show"){setShowHide(rootId,widgetJson,obj[key].data,obj[key].value,obj[key].element);}else if(type==="btn"){setJsonDataBtn(rootId,widgetJson,obj[key].data,obj[key].value,obj[key].secondValue,obj[key].element,obj[key].cssOption);}else{setJsonData(rootId,widgetJson,obj[key].data,obj[key].value,obj[key].element,obj[key].cssOption,obj[key].cssType);}}}
function setJsonData(rootId,widgetJson,obj,value,element,styleOpt,type){if(!widgetJson[obj])return;const option=widgetJson[obj][value];let inputOption=option;if(option==null)return;if(styleOpt==="border-top-right-radius"&&element===".goodappsw-bg-top"&&inputOption!=0){inputOption=+inputOption+3;}
if(type==="size"){inputOption=inputOption+'px';}
const elements=getAppSelectorAll('.'+element,rootId);elements.forEach((element)=>{element.style[styleOpt]=inputOption;})}
function setJsonDataBtn(rootId,widgetJson,obj,value,value_2,element,styleOpt){if(!widgetJson[obj])return;const option=widgetJson[obj][value];const option_2=widgetJson[obj][value_2];let btn;if(option==null)return;let inputOption=option;btn=inputOption;let inputOption_2=option_2;const elements=getAppSelectorAll('.'+element,rootId);elements.forEach((element)=>{element.style[styleOpt]=inputOption;element.addEventListener("mouseover",function(){this.style[styleOpt]=inputOption_2;},false);element.addEventListener("mouseout",function(){this.style[styleOpt]=btn;},false);})}
function setShowHide(rootId,widgetJson,obj,value,element){if(!widgetJson[obj])return;const option=widgetJson[obj][value];if(option==null)return;const elements=getAppSelectorAll('.'+element,rootId);elements.forEach((element)=>{if(option){element.classList.remove('goodappsw-hide');}else{element.classList.add('goodappsw-hide');}})}
class Timer{constructor(data){this.element=data.display;this.minutes=parseInt(data.minutes);this.seconds=parseInt(data.seconds);this.rootId=data.rootId;this.mainOfferId=data.mainOfferId;this.offerId=data.offerId;this.offerObj=null
this.pageReload=false;this.currentTriggerType=0;if(data.offerObj){this.offerObj=data.offerObj;this.pageReload=data.offerObj.pageReload||false;this.currentTriggerType=data.offerObj.currentTriggerType||0;}
this.counter=null;}
startTimer(){this.counter=setInterval(()=>{if(+this.seconds===0){if(+this.minutes===0){this.stopTimer()
removeAppContainer(this.rootId);sendStatistic(this.mainOfferId,this.offerId);statisticArr.length=0;if(this.currentTriggerType===triggerTypes.buyItNow||this.currentTriggerType===triggerTypes.beforeCheckout){setTimeout(()=>{createOrder();},1000);}else if(this.pageReload){setTimeout(()=>{cartReload(this.offerObj);},1000);}}else{this.minutes--;this.seconds=59;}}
this.seconds=this.seconds<10?'0'+ +this.seconds:this.seconds;this.minutes=this.minutes<10?'0'+ +this.minutes:this.minutes;this.element.innerText=this.minutes+":"+this.seconds;this.seconds--;},1000);}
reStartTimer(element,minutes,seconds,rootId){this.element=element;this.minutes=parseInt(minutes);this.seconds=parseInt(seconds);this.rootId=rootId;this.stopTimer();this.startTimer();}
stopTimer(){clearInterval(this.counter);}}
function buildTimer(minutes,seconds,display){display.innerHTML="";minutes=parseInt(minutes);seconds=parseInt(seconds);seconds=seconds<10?"0"+seconds:seconds;minutes=minutes<10?"0"+minutes:minutes;display.innerText=minutes+":"+seconds;}
async function fetchCart(){const options={method:'GET',headers:{"Content-Type":"application/json","Accept":"application/json"}};const resp=await fetch("/cart.json",options);return await resp.json();}
async function addItem(variantId,quantity,properties={}){const options={method:'POST',headers:{"Content-Type":"application/json","Accept":"application/json"},body:JSON.stringify({id:variantId,quantity:quantity,properties:properties})};const url="/cart/add.json";const resp=await fetch(url,options);return await resp.json();}
async function removeItem(data){const options={method:'POST',headers:{"Content-Type":"application/json","Accept":"application/json"},body:JSON.stringify({...data,quantity:0})};const url="/cart/change.js";const resp=await fetch(url,options);return await resp.json();}
function removeItemById(id){return removeItem({id:`${id}`});}
function removeItemByLine(oneBasedLineIndex){return removeItem({line:oneBasedLineIndex});}
async function updateItem(data){const options={method:'POST',headers:{"Content-Type":"application/json","Accept":"application/json"},body:JSON.stringify(data)};const url="/cart/change.js";const resp=await fetch(url,options);return await resp.json();}
function updateItemByLine(oneBasedLineIndex,newQuantity,newProperties={}){return updateItem({line:oneBasedLineIndex,quantity:newQuantity,properties:newProperties});}
async function fetchPage(url){const options={method:'GET',headers:{"Content-Type":"application/json","Accept":"application/json"}};const resp=await fetch(`${url}.json`,options);return await resp.json();}
async function fetchProduct(handle){const options={method:'GET',headers:{"Content-Type":"application/json","Accept":"application/json"}};const resp=await fetch(`/products/${handle}.json`,options);return resp.json();}
function setOfferFetchUrl(offerParams,url){const domain=goodappswShop;const product_id=offerParams.productId?`&product_id=${offerParams.productId}`:'';const variants_id=offerParams.variantsId?`&variants_id=${offerParams.variantsId}`:'';const trigger_event=offerParams.triggerType;const display_on_device=window.innerWidth>991?'3':'2';const cart_value=offerParams.cartValue?offerParams.cartValue:0;const page_id=trigger_event==='4'?`&page_select=${offerParams.targetCode}`:'';const button_code=trigger_event==='5'?`&button_code=${encodeURIComponent(offerParams.targetCode)}`:'';const exclude_offers=excludeOffers.length?`&exclude_offers=${excludeOffers.join(',')}`:'';const cart=offerParams.cart?offerParams.cart:0;let logged_user='0';let user_tags='0';if(typeof(goodAppsData)!=='undefined'){const{customerId,customerTags}=goodAppsData;if(customerTags.length===1&&customerTags.includes('')){customerTags.pop();}
logged_user=customerId?'1':logged_user;user_tags=customerTags.length?customerTags.join(','):user_tags;}
let urlParameter=getCookie('goodappswUrl');let parameter='';if(urlParameter){parameter=urlParameter;}
const url_parameter=parameter?`&url_parameter=${encodeURIComponent(parameter)}`:'';return goodappswApiUrl+`${url}?domain=${domain}${product_id}${variants_id}&cart=${cart}&trigger_event=${trigger_event}&display_on_device=${display_on_device}&cart_value=${cart_value}&logged_user=${logged_user}&user_tags=${user_tags}${page_id}${button_code}${url_parameter}${exclude_offers}`;}
async function offerFetch(offerParams){const options={headers:{'Content-Type':'application/json',"Accept":"application/json"}};const url=setOfferFetchUrl(offerParams,'api/front/offers');const resp=await fetch(url,options);if(!resp.ok){throw new Error(`HTTP error, status = ${resp.status}`);}
return await resp.json();}
async function offerVolumeDiscountFetch(offerParams){getExcludeCartOffer();const options={headers:{'Content-Type':'application/json',"Accept":"application/json"}};const url=setOfferFetchUrl(offerParams,'api/front/volume-discount');const resp=await fetch(url,options);if(!resp.ok){throw new Error(`HTTP error, status = ${resp.status}`);}
return await resp.json();}
async function offerFetchPreview(offerParams){const options={headers:{'Content-Type':'application/json',"Accept":"application/json"}};const domain=goodappswShop;const product_id=offerParams.productId?`&product_id=${offerParams.productId}`:'';const params=new URLSearchParams(window.location.search)
const main_offer_id=params.get('offerId');let url=goodappswApiUrl+`api/front/offers/popup-data?domain=${domain}${product_id}&main_offer_id=${main_offer_id}`;const resp=await fetch(url,options);if(!resp.ok){throw new Error(`HTTP error, status = ${resp.status}`);}
return await resp.json();}
async function createStatisticFetch(main_offer_id,offer_id,addedToCart,funnelViews){const options={method:'POST',headers:{'Content-Type':'application/json',"Accept":"application/json"},body:JSON.stringify(createStatisticRequest(main_offer_id,offer_id,addedToCart,funnelViews))};let url=goodappswApiUrl+`api/front/statistic`;const resp=await fetch(url,options);if(!resp.ok){throw new Error(`HTTP error, status = ${resp.status}`);}
return await resp.text();}
function createStatisticRequest(main_offer_id,offer_id,addedToCart,views){const domain=goodappswShop;const action=addedToCart?'accept':'decline';return{domain:domain,main_offer_id:main_offer_id,offer_id:offer_id,action:action,views:views}}
function sendStatistic(mainOfferId,offerId,funnelAction=false){if(statisticArr.includes(offerId)){const offerIdsArr=statisticArr.filter(element=>element===offerId);let funnelViews;if(funnelAction){funnelViews=offerIdsArr.length>1?0:1;}else{funnelViews=offerIdsArr.length>=1?0:1;}
createStatisticFetch(mainOfferId,offerId,funnelAction,funnelViews);}else{createStatisticFetch(mainOfferId,offerId,funnelAction,1);}}
async function createPurchaseFetch(data){const options={method:'POST',headers:{'Content-Type':'application/json',"Accept":"application/json"},body:JSON.stringify(createPurchaseRequest(data))};let url=goodappswApiUrl+`api/front/purchase`;const resp=await fetch(url,options);if(!resp.ok){throw new Error(`HTTP error, status = ${resp.status}`);}
return await resp.text();}
function createPurchaseRequest(data){const domain=goodappswShop;const main_offer_id=data.main_offer_id;const amount=[];data.offer_amount.forEach(item=>{amount.push({offer_id:item.offer_id,amount:item.amount})});return{domain:domain,main_offer_id:main_offer_id,offer_amount:amount}}
function createPurchaseData(mainOfferId,offerId,variantId,propertyId,storePrice){const localOfferData=localStorage.getItem('goodappswPurchaseData');purchaseData=localOfferData?JSON.parse(localOfferData):purchaseData;let offerData={'main_offer_id':mainOfferId,'offer':[]}
if(purchaseData.length){const checkMainOfferId=purchaseData.find(item=>item.main_offer_id===mainOfferId);if(checkMainOfferId){setOfferData(checkMainOfferId);}else{purchaseData.push(offerData);setOfferData(offerData);}}else{purchaseData.push(offerData)
setOfferData(offerData);}
function setOfferData(data){data.offer.push({offer_id:offerId,product_id:variantId,property_id:propertyId,product_store_price:storePrice})}
localStorage.setItem('goodappswPurchaseData',JSON.stringify(purchaseData));}
async function createOrderIdFetch(id){let domain=(typeof goodappswShop!=='undefined')?goodappswShop:window.location.hostname;const order_tag=goodappswOrderTag?goodappswOrderTag:'WholesaleGA';const options={method:'POST',headers:{'Content-Type':'application/json',"Accept":"application/json"},body:JSON.stringify({order_id:id,order_tag,domain:domain})};let url=goodappswApiUrl+`api/front/order-tag`;const resp=await fetch(url,options);if(!resp.ok){throw new Error(`HTTP error, status = ${resp.status}`);}
return await resp.json();}
const s_ajaxListener=new Object();s_ajaxListener.tempOpen=XMLHttpRequest.prototype.open;s_ajaxListener.tempSend=XMLHttpRequest.prototype.send;s_ajaxListener.callback=function(){let thisUrl=this.url.replace(/\?(.+)/ig,"");if(thisUrl==="/cart/add.js"||thisUrl==="/cart/add.json"||thisUrl==="/cart/add"){let dataStr,variantsId;if(typeof(this.data)==='object'){if(this.data instanceof FormData){for(let pair of this.data.entries()){if(pair[0]==='id'){variantsId=pair[1];}}}}else if(typeof(this.data)==='string'){if(this.data.includes('&')){dataStr=this.data.split('&');dataStr.forEach(element=>{if(element.includes('id=')){variantsId=element.split('=');variantsId=variantsId[variantsId.length-1];}});}else if(this.data.includes('{')){dataStr=JSON.parse(this.data);variantsId=dataStr.id?dataStr.id:dataStr.items[0].id;}}
if(volumeOffer&&volumeOffer.allVariantsId.includes(+variantsId)){addToCartVolume(variantsId);}}
if(thisUrl==="/cart/change.js"||thisUrl==="/cart/change.json"||thisUrl==="/cart/change"){setTimeout(()=>{if(runUpdate){checkVolumeProducts();}
setTimeout(()=>{cartPageDiscount();},1000);},500);}}
XMLHttpRequest.prototype.open=function(a,b){if(!a)var a='';if(!b)var b='';s_ajaxListener.tempOpen.apply(this,arguments);s_ajaxListener.method=a;s_ajaxListener.url=b;if(a.toLowerCase()=='get'){s_ajaxListener.data=b.split('?');s_ajaxListener.data=s_ajaxListener.data[1];}}
XMLHttpRequest.prototype.send=function(a,b){if(!a)var a='';if(!b)var b='';s_ajaxListener.tempSend.apply(this,arguments);if(s_ajaxListener.method.toLowerCase()=='post')s_ajaxListener.data=a;s_ajaxListener.callback();}
const nativeFetch=window.fetch;window.fetch=async function(...args){if(typeof(args[0])!="string"){return nativeFetch.apply(window,args);}
let thisUrl=args[0].replace(/\?(.+)/ig,"");if(thisUrl==="/cart/add.js"||thisUrl==="/cart/add.json"||thisUrl==="/cart/add"){if(typeof args[1].body==='string'&&(args[1].body.includes('offer')||triggerProduct)){triggerProduct=false;return nativeFetch.apply(window,args);}
let response=await nativeFetch.apply(window,args);if(response.status===200){let dataArgs,variantsId;if(typeof(args[1].body)==='object'&&args[1].body instanceof FormData){for(let pair of args[1].body.entries()){if(pair[0]==='id'){variantsId=pair[1];}}}else if(typeof(args[1].body)==='string'){if(args[1].body.includes('&')){dataArgs=args[1].body.split('&');dataArgs.forEach(element=>{if(element.includes('id=')){variantsId=element.split('=');variantsId=variantsId[variantsId.length-1];}});}else if(args[1].body.includes('{')){dataArgs=JSON.parse(args[1].body);variantsId=dataArgs.id?dataArgs.id:dataArgs.items[0].id;}}else{return response;}
if(volumeOffer&&volumeOffer.allVariantsId.includes(+variantsId)){addToCartVolume(variantsId);}}
return response}else if(thisUrl==="/cart/change.js"||thisUrl==="/cart/change.json"||thisUrl==="/cart/change"){let response=await nativeFetch.apply(window,args);if(response.status===200){if(runUpdate){checkVolumeProducts();}
setTimeout(()=>{cartPageDiscount();},1000);}
return response}else{return nativeFetch.apply(window,args);}}
function addToCartVolume(variantsId){fetchCart().then(dataCart=>{const targetProduct=dataCart.items.find(product=>product.variant_id===+variantsId&&(!!!product.properties||(product.properties&&!product.properties.offer)));const funnelProduct=dataCart.items.find(product=>product.variant_id===+variantsId&&(product.properties&&product.properties.offer));if(targetProduct){runUpdate=false;const targetIndex=dataCart.items.findIndex(product=>product.variant_id===+variantsId&&(!!!product.properties||(product.properties&&!product.properties.offer)));let{variant_id,quantity,properties,discounted_price}=targetProduct;let propertyId=funnelProduct?funnelProduct.properties.offer:makeId(5);let{volumeDataOptions,offerObj}=volumeOffer;let discountType=null;let discountValue=null;let storePrice=+discounted_price / 100;volumeDataOptions.forEach(option=>{const optionQty=option.allow_range?option.range_to:option.range_from;if(optionQty<=quantity||option.range_from<=quantity){discountType=option.discount_type;discountValue=option.discount_value;}})
updateItemByLine(targetIndex+1,quantity,{...properties,offer:propertyId}).then(()=>{createOrderData(variant_id,propertyId,discountType,discountValue,quantity);createPurchaseData(offerObj.mainOfferId,offerObj.offerId,variant_id,propertyId,storePrice);createVolumeProductsData(offerObj.volumeId,variant_id,propertyId);sendStatistic(offerObj.mainOfferId,offerObj.offerId,true);createVolumeData(offerObj.volumeId,volumeDataOptions);runUpdate=true;checkVolumeProducts(true);});}});}
function checkVolumeProducts(runManually){const localVolumeData=JSON.parse(localStorage.getItem('goodappswVolumeData'));const localDataOrder=JSON.parse(localStorage.getItem('kaktusDataOrder'));if(!localVolumeData)return;fetchCart().then(dataCart=>{localVolumeData.forEach(volumeSet=>{let volumeOrderQty=0;let volumeCartQty=0;for(let i=0;i<volumeSet.volumeProducts.length;i++){const targetProduct=localDataOrder.find(item=>item.propertyId===volumeSet.volumeProducts[i].propertyId);if(targetProduct){volumeOrderQty+=+targetProduct.qty;}
const targetCartProduct=dataCart.items.find(item=>item.properties&&item.properties.offer&&item.properties.offer===volumeSet.volumeProducts[i].propertyId);if(targetCartProduct){volumeCartQty+=+targetCartProduct.quantity;}}
if(+volumeOrderQty!==+volumeCartQty||runManually){let volumeDiscountArr=[];createVolumeDiscountArray(volumeDiscountArr,volumeSet,volumeCartQty);changeVolumeDiscount(dataCart,volumeDiscountArr,localDataOrder,volumeSet);}});updateVolumeData(dataCart,localVolumeData);});}
function createVolumeDiscountArray(volumeDiscountArr,volumeSet,volumeCartQty){let currentCartQty=volumeCartQty;let currentOption=null;volumeSet.volumeOptions.forEach(option=>{const optionQty=option.allow_range?option.range_to:option.range_from;if(optionQty<=currentCartQty||option.range_from<=currentCartQty){currentOption={qty:optionQty,discount_type:option.discount_type,discount_value:option.discount_value};}});if(currentOption===null){volumeDiscountArr.push({qty:`${currentCartQty}`,discount_type:null,discount_value:null});return false;}else{volumeDiscountArr.push(currentOption);}
currentCartQty=+currentCartQty- +currentOption.qty;if(currentCartQty<=0)return false;createVolumeDiscountArray(volumeDiscountArr,volumeSet,currentCartQty);}
function changeVolumeDiscount(dataCart,volumeDiscountArr,localDataOrder,volumeSet){const{volumeProducts}=volumeSet;dataCart.items.forEach(product=>{const isProductInSet=volumeProducts.find(item=>+item.variantId===+product.id);if(product.properties&&product.properties.offer&&isProductInSet){const productProperty=product.properties.offer;const productQty=product.quantity;let productPrice=+product.discounted_price / 100;let currentProductQty=productQty;let isDiscount=false;const totalPrice=productPrice*productQty;let totalDiscountedPrice=totalPrice;for(let i=0;i<volumeDiscountArr.length;i++){let discount=0;let{qty,discount_type,discount_value}=volumeDiscountArr[i];if(+qty===0){continue;}
if(+qty>=+currentProductQty){if(discount_value){if(discount_type==="%"){discount=+productPrice*+discount_value / 100;}else{discount=+discount_value;}
isDiscount=true;totalDiscountedPrice=(totalDiscountedPrice*100-(discount*+currentProductQty*100))/ 100;}
qty=+qty- +currentProductQty;volumeDiscountArr[i].qty=`${qty}`;break;}else{if(discount_value){if(discount_type==="%"){discount=+productPrice*+discount_value / 100;}else{discount=+discount_value;}
isDiscount=true;totalDiscountedPrice=(totalDiscountedPrice*100-(discount*+qty*100))/ 100;}
currentProductQty=currentProductQty- +qty;volumeDiscountArr[i].qty=`0`;}}
const result=(totalPrice*100-totalDiscountedPrice*100)/ 100;let currentDiscount=isDiscount?(result / productQty).toFixed(2):null;const targetOrderProduct=localDataOrder.find(item=>item.propertyId===productProperty);targetOrderProduct.qty=productQty;targetOrderProduct.discountType=`${goodappswCurrencySymbol.includes('{{') ? currentCurrencySymbol.replace(/{{(.*?)}}/ig, '') : currentCurrencySymbol}`;targetOrderProduct.discountValue=`${currentDiscount}`;}});localStorage.setItem('kaktusDataOrder',JSON.stringify(localDataOrder));}
function updateVolumeData(dataCart,localVolumeData){if(dataCart.items.length<1||localVolumeData.length<1){localStorage.removeItem('goodappswVolumeData');}else{localVolumeData.forEach((volumeSet,index)=>{if(volumeSet.volumeProducts.length){for(let i=0;i<volumeSet.volumeProducts.length;i++){const isVolumeProduct=dataCart.items.find(item=>item.properties.offer===volumeSet.volumeProducts[i].propertyId);if(!isVolumeProduct){volumeSet.volumeProducts.splice(i,1);}}}else{localVolumeData.splice(index,1);}});localStorage.setItem('goodappswVolumeData',JSON.stringify(localVolumeData));}}
if(location.href.includes('/cart')){checkVolumeProducts();setTimeout(()=>{cartPageDiscount();},1000);}
if("/thank_you"===location.href.slice(-10)||Shopify.checkout){const orderItems=Shopify.checkout.line_items;const orderId=Shopify.checkout.order_id;const offerData=JSON.parse(localStorage.getItem('goodappswPurchaseData'));sendOrderId(offerData,orderItems,orderId);sendPurchaseAPI(offerData,orderItems);localStorage.removeItem('kaktusDataOrder');}
function sendOrderId(offerData,orderItems,orderId){if(!offerData){return}
const funnelProductsList=[];offerData.forEach(mainOfferItem=>{mainOfferItem.offer.forEach(offerItem=>{funnelProductsList.push(offerItem.property_id);})})
for(let i=0;i<funnelProductsList.length;i++){const isFunnelProduct=orderItems.find(item=>funnelProductsList[i]===item.properties.offer);if(isFunnelProduct){createOrderIdFetch(orderId);break;}}}
function sendPurchaseAPI(offerData,orderItems){if(!offerData){return}
offerData.forEach(mainOfferItem=>{const offerDataItem={'main_offer_id':mainOfferItem.main_offer_id,'offer_amount':[]}
mainOfferItem.offer.forEach(offerItem=>{const lineItemProperty=orderItems.find(item=>offerItem.property_id===item.properties.offer)
if(lineItemProperty){let discount;let qty=+lineItemProperty.quantity!==0?+lineItemProperty.quantity:1;if(lineItemProperty.applied_discounts.length>0&&lineItemProperty.applied_discounts[0].amount){discount=lineItemProperty.applied_discounts[0].amount;}
if(offerDataItem.offer_amount.length){const checkOfferId=offerDataItem.offer_amount.find(item=>item.offer_id===offerItem.offer_id);if(checkOfferId){checkOfferId.amount=(+checkOfferId.amount+(discount?(+offerItem.product_store_price*qty)-discount:+offerItem.product_store_price*qty)).toFixed(2);}else{offerDataItem.offer_amount.push({offer_id:offerItem.offer_id,amount:discount?((+offerItem.product_store_price*qty)-discount).toFixed(2):(+offerItem.product_store_price*qty).toFixed(2)});}}else{offerDataItem.offer_amount.push({offer_id:offerItem.offer_id,amount:discount?((+offerItem.product_store_price*qty)-discount).toFixed(2):(+offerItem.product_store_price*qty).toFixed(2)});}}})
if(offerDataItem.offer_amount.length){createPurchaseFetch(offerDataItem);}})
localStorage.removeItem('goodappswPurchaseData');}
if(location.href.includes('/pages/')){const triggerType=triggerTypes.selectedPages;if(Object.keys(goodappswTriggerEvents).length&&goodappswTriggerEvents.includes(+triggerType)){fetchPage(location.href).then(dataPage=>{const pageId=dataPage.page.id;if(goodappswPageIds.includes(pageId)){const offerParams={triggerType,cart:'0',variantsId:'0',cartValue:'0',targetCode:pageId}
if(location.href.includes('offerId')){offerFetchPreview(offerParams).then(dataOffer=>{if(dataOffer.offers){buildPopUpType({dataOffer,triggerType});}});}else{offerFetch(offerParams).then(dataOffer=>{if(dataOffer.offers){buildPopUpType({dataOffer,triggerType});}});}}})}}
if(location.href.includes('/products/')){const triggerType=triggerTypes.productPage;if(Object.keys(goodappswTriggerEvents).length&&goodappswTriggerEvents.includes(+triggerType)){let url=location.href.split('/');let productsIndex=url.indexOf('products');url=url[productsIndex+1];fetchProduct(url).then(function(dataPage){const productId=dataPage.product.id;const allVariantsId=dataPage.product.variants.map(item=>item.id);fetchCart().then(function(dataCart){let cart='0';if(dataCart.items.length){cart=dataCart.items.map(item=>item.product_id);cart=cart.join();}
const offerParams={triggerType,productId,cart,cartValue:dataCart.total_price}
if(location.href.includes('offerId')){offerFetchPreview(offerParams).then(dataOffer=>{if(dataOffer.offers){currentProductId=dataPage.product.id;let isProductInResp=dataOffer.products[productId];if(!isProductInResp){dataOffer.products[productId]=setTriggerProductToOffer(dataPage.product);}
buildPopUpType({dataOffer,dataCart,currentProductId,triggerType,allVariantsId,currentProduct:dataPage.product});}});}else{offerVolumeDiscountFetch(offerParams).then(dataOffer=>{if(dataOffer.offers){currentProductId=dataPage.product.id;let isProductInResp=dataOffer.products[productId];if(!isProductInResp){dataOffer.products[productId]=setTriggerProductToOffer(dataPage.product);}
buildPopUpType({dataOffer,dataCart,currentProductId,triggerType,allVariantsId,currentProduct:dataPage.product});}});}});})}}
function setTriggerProductToOffer(product){const regex=/(<([^>]+)>)/ig;const variantsObj={};for(let key in product.variants){if(product.variants.hasOwnProperty(key)){let variantItem=product.variants[key];let variantObj={title:variantItem.title,description:product.body_html?(product.body_html).replace(regex,""):"",inventory_management:variantItem.inventory_management,productId:variantItem.id,variantPrice:variantItem.price,}
variantsObj[variantItem.id]=variantObj;}}
return{title:product.title,description:product.body_html?(product.body_html).replace(regex,""):"",inventory_management:product.variants[0].inventory_management,productId:product.id,variants:variantsObj,fbtTriggeredProduct:true}}
function setTriggerProductIds(product){const variantsArr=[];for(let key in product.variants){if(product.variants.hasOwnProperty(key)){variantsArr.push(product.variants[key].id);}}
return{[product.id]:variantsArr}}!function(){let lastBtn=null
document.addEventListener('click',function(e){if(!e.target.closest)return;lastBtn=e.target.closest('button, input[type=submit]');},true);document.addEventListener('submit',function(e){if('submitter'in e)return;var canditates=[document.activeElement,lastBtn];lastBtn=null;for(var i=0;i<canditates.length;i++){var candidate=canditates[i];if(!candidate)continue;if(!candidate.form)continue;if(!candidate.matches('button, input[type=submit]'))continue;e.submitter=candidate;return;}
e.submitter=e.target.querySelector('button, input[type=submit]')},true);}();document.addEventListener("submit",function(e){if("string"==typeof e.target.action){let actionUrl=e.target.action;if(actionUrl.includes('?')){actionUrl=actionUrl.split('?')[0];}
if("/checkout"===actionUrl.slice(-9)||"/cart"===actionUrl.slice(-5)){const btnType=e.submitter.getAttribute('name');if(btnType&&btnType==='update')return;e.preventDefault();createOrder();}}});if(!!document.querySelector('a[href="/checkout"]')){document.querySelector('a[href="/checkout"]').addEventListener('click',function(e){e.preventDefault();createOrder();})}
if(goodappswTriggerButton.length&&Object.keys(goodappswTriggerEvents).length&&!goodappswTriggerEvents.includes(11)){storeCheckoutEvent();}
function storeCheckoutEvent(){let triggersString=decodeHTML(goodappswTriggerButton);const checkoutButtonArr=triggersString.split(',');let clicked=false;document.addEventListener("click",function(e){checkoutButtonArr.forEach(item=>{const itemTrim=item.trim();const currentTrigger=document.querySelectorAll(itemTrim);if(currentTrigger!=null){currentTrigger.forEach(elem=>{if(e.target===elem&&!clicked){e.preventDefault();e.stopImmediatePropagation();createOrder();clicked=true;setTimeout(()=>{clicked=false;},500);}});}})},true);}
async function createOrderFetch(dataCart,orderData){const options={method:'POST',headers:{'Content-Type':'application/json',"Accept":"application/json"},body:JSON.stringify(createOrderRequest(dataCart,orderData))};let url=goodappswApiUrl+`api/front/draft-order`;const resp=await fetch(url,options);if(!resp.ok){throw new Error(`HTTP error, status = ${resp.status}`);}
return await resp.json();}
function createOrderRequest(dataCart,orderData){const domain=goodappswShop;const line_items=[];let discount=null;let properties=null;dataCart.forEach(item=>{let qty=item.quantity;if(orderData){if(!!item.properties&&!!item.properties.offer){const lineItemProperty=orderData.find(prod=>prod.propertyId===item.properties.offer);if(lineItemProperty){discount=lineItemProperty.discountValue!=null?{value_type:lineItemProperty.discountType,value:+lineItemProperty.discountValue}:null;item.properties.offer=lineItemProperty.propertyId;properties=item.properties;qty=+lineItemProperty.qty;}}else{discount=null;properties=item.properties;}}
line_items.push({title:item.title,product_id:item.product_id,variant_id:item.variant_id,price:goodappswCurrencyCode!==currentCurrencyCode?getStorePriceByRate(item.price / 1000)*1000:item.price,quantity:qty,discount:discount,properties:properties})
if(+item.quantity>+qty){let result=+item.quantity- +qty;item.properties.offer=null;line_items.push({title:item.title,product_id:item.product_id,variant_id:item.variant_id,price:goodappswCurrencyCode!==currentCurrencyCode?getStorePriceByRate(item.price / 1000)*1000:item.price,quantity:result,discount:null,properties:item.properties})}})
return{domain:domain,line_items:line_items}}
function createOrderData(variantId,propertyId,discountType,discountValue,qty){const localOrderData=localStorage.getItem('kaktusDataOrder');orderData=localOrderData?JSON.parse(localOrderData):orderData;let productData={variantId:variantId,propertyId:propertyId,discountType:discountType,discountValue:discountValue,qty:qty}
orderData.push(productData);localStorage.setItem('kaktusDataOrder',JSON.stringify(orderData));}
function createOrder(){const modalBody=document.querySelector("#goodappsw-app");if(modalBody){getAppSelector('.goodappsw-popup__body').classList.add('goodappsw-preload');}
const line_items=[];fetchCart().then(function(dataCart){const orderData=JSON.parse(localStorage.getItem('kaktusDataOrder'));dataCart.items.forEach(item=>{if(orderData){if(!!item.properties&&!!item.properties.offer){const lineItemProperty=orderData.find(prod=>prod.propertyId===item.properties.offer);if(lineItemProperty){if(lineItemProperty.discountValue!=null){line_items.push(item);}}}}});if(line_items.length){createOrderFetch(dataCart.items,orderData).then(result=>{setTimeout(()=>{location.href=result.checkout;},1000);},error=>{location.href='/checkout';})}else{location.href='/checkout';}})}
function goToCart(){const modalBody=document.querySelector("#goodappsw-app");if(modalBody){getAppSelector('.goodappsw-popup__body').classList.add('goodappsw-preload');}
let domain=location.href.split('/');domain=domain[0]+'//'+domain[2];location.href=domain+'/cart';};function facebookPixel(){if(!facebookId){return;}else{!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');fbq('init',facebookId);fbq('track','PageView');}}
function googleAnalytics(){if(!googleId){return;}else{(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create',googleId,'auto');ga('send','pageview');}}
function pinteresPixel(){if(!pinterestId){return;}else{!function(e){if(!window.pintrk){window.pintrk=function(){window.pintrk.queue.push(Array.prototype.slice.call(arguments))};var
n=window.pintrk;n.queue=[],n.version="3.0";var
t=document.createElement("script");t.async=!0,t.src=e;var
r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r)}}
("https://s.pinimg.com/ct/core.js");pintrk('load',pinterestId);pintrk('page');pintrk('track','pagevisit');}}
function snapPixel(){if(!snapId){return;}else{(function(win,doc,sdk_url){if(win.snaptr)return;var tr=win.snaptr=function(){tr.handleRequest?tr.handleRequest.apply(tr,arguments):tr.queue.push(arguments);};tr.queue=[];var s='script';var new_script_section=doc.createElement(s);new_script_section.async=!0;new_script_section.src=sdk_url;var insert_pos=doc.getElementsByTagName(s)[0];insert_pos.parentNode.insertBefore(new_script_section,insert_pos);})(window,document,'https://sc-static.net/scevent.min.js');snaptr('init',snapId,{'user_email':snapEmail})
snaptr('track','PAGE_VIEW');}}
function tikTokPixel(){if(!tikTokId){return;}else{!function(w,d,t){w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var i="https://analytics.tiktok.com/i18n/pixel/events.js";ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=i,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src=i+"?sdkid="+e+"&lib="+t;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)};ttq.load(tikTokId);ttq.page();}(window,document,'ttq');}}
function socialPixel(){facebookPixel();googleAnalytics();pinteresPixel();snapPixel();tikTokPixel()}
function getExcludeCartOffer(){const offerId=localStorage.getItem(`goodappswExcludeCartOfferId`);if(!offerId)return;excludeOffers.push(offerId);localStorage.removeItem(`goodappswExcludeCartOfferId`);}
function cartReload(offerObj){if(offerObj.cartOfferExcludeId){localStorage.setItem(`goodappswExcludeCartOfferId`,offerObj.cartOfferExcludeId);}
location.reload();}
function cartPageDiscount(){let defaultSubTotalPriceClass=['.cart-subtotal__price','.totals__subtotal-value'];let settingSubTotalPriceClass=goodappswCartSubtotal.length?decodeHTML(goodappswCartSubtotal).split(','):[];let defaultSubTotalContainerClass=['.cart-subtotal','.totals'];let settingSubTotalContainerClass=goodappswCartSubtotalContainer.length?decodeHTML(goodappswCartSubtotalContainer).split(','):[];const subTotalPrice=getDomElement(defaultSubTotalPriceClass,settingSubTotalPriceClass);const subTotalContainer=getDomElement(defaultSubTotalContainerClass,settingSubTotalContainerClass);if(!subTotalPrice||!subTotalContainer)return;const localDataOrder=JSON.parse(localStorage.getItem('kaktusDataOrder'));if("/cart"===location.href.slice(-5)&&localDataOrder){runCartPageDiscount();cartProductItemDiscount();}
function runCartPageDiscount(){const cartContainer=document.querySelector(`.goodapps-cart-container`);if(cartContainer){subTotalPrice.style.textDecoration='';cartContainer.remove();}
const isDiscount=localDataOrder.find(product=>product.discountValue!=null&&product.discountValue!=="null");if(!isDiscount)return;fetchCart().then(function(dataCart){const{total_price,items}=dataCart;if(items.length){let totalDiscountPrice=calcDiscountPrice(localDataOrder,items);buildDiscountContainer(total_price,totalDiscountPrice);}});}
function calcDiscountPrice(localDataOrder,items){let totalDiscountPrice=0;items.forEach(productItem=>{if(!!productItem.properties&&!!productItem.properties.offer){const lineItemProperty=localDataOrder.find(product=>product.propertyId===productItem.properties.offer);if(lineItemProperty&&+lineItemProperty.discountValue){let productPrice=productItem.discounted_price / 100;if(lineItemProperty.discountType==='%'){productPrice=(+productPrice-(+productPrice*+lineItemProperty.discountValue / 100)).toFixed(2);}else{productPrice=(+productPrice- +lineItemProperty.discountValue).toFixed(2);}
totalDiscountPrice+=productPrice*lineItemProperty.qty;}else{totalDiscountPrice+=(productItem.discounted_price / 100)*productItem.quantity;}}else{totalDiscountPrice+=(productItem.discounted_price / 100)*productItem.quantity;}})
return totalDiscountPrice;}
function buildDiscountContainer(totalPrice,totalDiscountPrice){const discount=(totalPrice-(totalDiscountPrice*100))/ 100;if(+discount===0)return;const html=`
                    <p style="margin: 0 0 10px 0;">- ${currencyFormat(discount)}</p>
                    <p style="margin: 0; font-size: 1.4rem;">${currencyFormat(totalDiscountPrice)}</p>
                `;const element=document.createElement("div");element.classList.add("goodapps-cart-container");element.style.textAlign='right';element.innerHTML=html;subTotalContainer.after(element);subTotalPrice.style.textDecoration='line-through';}}
function cartProductItemDiscount(){const localDataOrder=JSON.parse(localStorage.getItem('kaktusDataOrder'));const isDiscount=localDataOrder.find(product=>product.discountValue!=null);if(!isDiscount)return;runCartItemDiscount(localDataOrder);function runCartItemDiscount(localDataOrder){const defaultCartItemClass=['.cart-item'];const settingCartItemClass=goodappswCartItemClass.length?decodeHTML(goodappswCartItemClass).split(','):[];const defaultTotalPriceClass=['.cart-item__price-wrapper .price'];const settingTotalPriceClass=goodappswCartItemPriceClass.length?decodeHTML(goodappswCartItemPriceClass).split(','):[];const cartItemNodes=getAllDomElements(defaultCartItemClass,settingCartItemClass);fetchCart().then(function(dataCart){const{items}=dataCart;if(items.length){items.forEach((item,i)=>{if(item.properties&&item.properties.offer){const discountItem=localDataOrder.find(product=>product.propertyId===item.properties.offer);const priceNodes=getAllDomElements(defaultTotalPriceClass,settingTotalPriceClass,cartItemNodes[i]);if(!discountItem||!+discountItem.discountValue||!priceNodes.length)return;const{price,quantity}=item;const discountedPrice=calcDiscountPrice(price,quantity,discountItem);priceNodes.forEach((nodeItem)=>{buildDiscountPrice(nodeItem,discountedPrice);});}})}});}
function calcDiscountPrice(price,quantity,discountItem){price=getPriceByRate(price);let discountedPrice=price / 100;if(discountItem.discountType==='%'){discountedPrice=(+discountedPrice-(+discountedPrice*+discountItem.discountValue / 100)).toFixed(2);}else{discountedPrice=(+discountedPrice- +discountItem.discountValue).toFixed(2);}
return(discountedPrice*quantity);}}
function showProductPageDiscount(productData,volumeOptions,currentProduct){const defaultProductPriceSelector=['.price__regular .price-item'];const settingProductPriceSelector=goodappswProductPriceClass.length?decodeHTML(goodappswProductPriceClass).split(','):[];const defaultProductQtySelector=['.quantity__input'];const settingProductQtySelector=goodappswProductQtyClass.length?decodeHTML(goodappswProductQtyClass).split(','):[];const defaultProductVariantSelector=['input[name=Color]'];const settingProductVariantSelector=goodappswProductVariantsClass.length?decodeHTML(goodappswProductVariantsClass).split(','):[];const priceNode=getDomElement(defaultProductPriceSelector,settingProductPriceSelector);const qtyNode=getDomElement(defaultProductQtySelector,settingProductQtySelector);const variantsNodes=getAllDomElements(defaultProductVariantSelector,settingProductVariantSelector);const selectedVariantId=getSelectedVariantId(currentProduct);const isTrigger=productData.variants.find(item=>+item.productId===+selectedVariantId);if(!priceNode||!qtyNode||!isTrigger){removeDiscountHtml(priceNode);return;};setDiscount(qtyNode.value,isTrigger);function setDiscount(qty,product){const updatePriceNode=getDomElement(defaultProductPriceSelector,settingProductPriceSelector);removeDiscountHtml(updatePriceNode);const productPrice=parseFloat(product.variantPrice);let volumeOptionsArr=[];createVolumeOptionsArray(volumeOptionsArr,volumeOptions,qty);const discountPrice=calcDiscountPrice(qty,product,volumeOptionsArr);if(productPrice!==+discountPrice){buildDiscountPrice(updatePriceNode,discountPrice);}}
function calcDiscountPrice(qtyInput,product,volumeOptionsArr){let currentProductQty=parseInt(qtyInput)
const price=parseFloat(product.variantPrice);const totalPrice=price*currentProductQty;let totalDiscountedPrice=totalPrice;let isDiscount=false;for(let i=0;i<volumeOptionsArr.length;i++){let{qty,discount_type,discount_value}=volumeOptionsArr[i];if(+qty===0){continue;}
if(+qty>=+currentProductQty){if(discount_value){isDiscount=true;totalDiscountedPrice=calcTotalDiscount(totalDiscountedPrice,price,discount_type,discount_value,currentProductQty);}
qty=+qty- +currentProductQty;volumeOptionsArr[i].qty=`${qty}`;break;}else{if(discount_value){isDiscount=true;totalDiscountedPrice=calcTotalDiscount(totalDiscountedPrice,price,discount_type,discount_value,qty);}
currentProductQty=currentProductQty- +qty;volumeOptionsArr[i].qty=`0`;}}
return+totalDiscountedPrice /+qtyInput;}
function createVolumeOptionsArray(volumeOptionsArr,volumeOptions,qty){let currentQty=+qty;let currentOption=null;volumeOptions.forEach(option=>{const optionQty=option.allow_range?option.range_to:option.range_from;if(+optionQty<=currentQty||+option.range_from<=currentQty){currentOption={qty:optionQty,discount_type:option.discount_type,discount_value:option.discount_value};}});if(currentOption===null){volumeOptionsArr.push({qty:`${currentQty}`,discount_type:null,discount_value:null});return false;}else{volumeOptionsArr.push(currentOption);}
currentQty=currentQty- +currentOption.qty;if(currentQty<=0)return false;createVolumeOptionsArray(volumeOptionsArr,volumeOptions,currentQty);}
function calcTotalDiscount(totalDiscountedPrice,price,discount_type,discount_value,qty){let discount=0;if(discount_type==="%"){discount=+price*+discount_value / 100;}else{discount=+discount_value;}
return(totalDiscountedPrice*100-(discount*+qty*100))/ 100;}
function getSelectedVariantId(currentProduct){const locationUrl=location.href;const url=new URL(locationUrl);const searchVariant=url.searchParams.get("variant");if(searchVariant){return searchVariant}else{return currentProduct.variants[0].id;}}
qtyNode.addEventListener('change',function(){const selectedVariantId=getSelectedVariantId(currentProduct);const currentVariant=productData.variants.find(item=>+item.productId===+selectedVariantId);setDiscount(this.value,currentVariant);});if(variantsNodes){variantsNodes.forEach(variantItem=>{if(variantItem.tagName==="SELECT"){variantItem.addEventListener('change',function(){setTimeout(()=>{const selectedVariantId=getSelectedVariantId(currentProduct);const currentVariant=productData.variants.find(item=>+item.productId===+selectedVariantId);const qty=qtyNode.value;setDiscount(qty,currentVariant);},500);});}else{variantItem.addEventListener('click',function(){setTimeout(()=>{const selectedVariantId=getSelectedVariantId(currentProduct);const currentVariant=productData.variants.find(item=>+item.productId===+selectedVariantId);const qty=qtyNode.value;setDiscount(qty,currentVariant);},500);});}})}}
function buildDiscountPrice(node,price){const element=node.cloneNode();element.classList.add('goodappsw-price-container');element.innerHTML=`${currencyFormat(price)}`;node.after(element);node.style.textDecoration='line-through';}
function removeDiscountHtml(priceNode){const priceContainer=document.querySelector(`.goodappsw-price-container`);if(priceContainer){priceNode.style.textDecoration='';priceContainer.remove();}}
function getDomElement(defaultNodeElements,settingsNodeElements){const commonNodeArr=settingsNodeElements.concat(defaultNodeElements);const uniqueNodeArr=[...new Set(commonNodeArr)];if(uniqueNodeArr.length){for(let i=0;i<uniqueNodeArr.length;i++){const itemTrim=uniqueNodeArr[i].trim();const currentNode=document.querySelector(itemTrim);if(currentNode!=null){return currentNode;}}}else{return null;}}
function getAllDomElements(defaultNodeElements,settingsNodeElements,rootNode){const commonNodeArr=settingsNodeElements.concat(defaultNodeElements);const uniqueNodeArr=[...new Set(commonNodeArr)];if(uniqueNodeArr.length){for(let i=0;i<uniqueNodeArr.length;i++){const itemTrim=uniqueNodeArr[i].trim();const currentNodes=rootNode?rootNode.querySelectorAll(itemTrim):document.querySelectorAll(itemTrim);if(currentNodes.length){return currentNodes;}}}else{return null;}}
function buildForm(params){const{dataOffer,offerItem,rootId}=params;const formOptions=offerItem.form.sign_up_form.options;const offerTexts=getFormOfferTexts(dataOffer,offerItem);const isContactsField={title:formOptions.title,first_name:formOptions.first_name,last_name:formOptions.last_name}
const isBusinessField={address:formOptions.address,address_2:formOptions.address_2,phone:formOptions.phone,city:formOptions.city,postal_code:formOptions.postal_code,country:formOptions.country,state:formOptions.state,company_name:formOptions.company_name,website:formOptions.website,tax_id:formOptions.tax_id,}
const requiredFields={title:formOptions.title_required,first_name:formOptions.first_name_required,last_name:formOptions.last_name_required,address:formOptions.address_required,address_2:formOptions.address_2_required,phone:formOptions.phone_required,city:formOptions.city_required,postal_code:formOptions.postal_code_required,country:formOptions.country_required,state:formOptions.state_required,company_name:formOptions.company_name_required,website:formOptions.website_required,tax_id:formOptions.tax_id_required,}
const isBusinessForm=Object.values(isBusinessField).some(item=>item===true);const businessHtml=`
                <div class="goodappsw-form__content-left">
                    <h3 class="goodappsw-form__subtitle">${offerTexts.business_title}</h3>

                    ${isBusinessField.address ?
                        `<div class="goodappsw-form__input-wrapper"><label for="gaw_address"class="goodappsw-form__label">${offerTexts.address}</label><input ${requiredFields.address?'required ':''}type="text"id="gaw_address"class="goodappsw-form__input"></div>` : ""
                    }

                    ${isBusinessField.address_2 ?
                        `<div class="goodappsw-form__input-wrapper"><label for="gaw_address_2"class="goodappsw-form__label">${offerTexts.address_2}</label><input ${requiredFields.address_2?'required ':''}type="text"id="gaw_address_2"class="goodappsw-form__input"></div>` : ""
                    }

                    ${isBusinessField.phone ?
                        `<div class="goodappsw-form__input-wrapper"><label for="gaw_phone"class="goodappsw-form__label">${offerTexts.phone}</label><input ${requiredFields.phone?'required ':''}type="tel"id="gaw_phone"class="goodappsw-form__input"></div><span id="gaw_phone_error_msg"style="display: none; color: #ff0000; margin-top: 4px;"></span>` : ""
                    }

                    ${isBusinessField.city ?
                        `<div class="goodappsw-form__input-wrapper"><label for="gaw_city"class="goodappsw-form__label">${offerTexts.city}</label><input ${requiredFields.city?'required ':''}type="text"id="gaw_city"class="goodappsw-form__input"></div>` : ""
                    }

                    ${isBusinessField.postal_code ?
                        `<div class="goodappsw-form__input-wrapper"><label for="gaw_postal_code"class="goodappsw-form__label">${offerTexts.postal_code}</label><input ${requiredFields.postal_code?'required ':''}type="text"id="gaw_postal_code"class="goodappsw-form__input"></div>` : ""
                    }

                    ${isBusinessField.country ?
                        `<div class="goodappsw-form__input-wrapper"><label for="gaw_country"class="goodappsw-form__label">${offerTexts.country}</label><input ${requiredFields.country?'required ':''}type="text"id="gaw_country"class="goodappsw-form__input"></div>` : ""
                    }

                    ${isBusinessField.state ?
                        `<div class="goodappsw-form__input-wrapper"><label for="gaw_state"class="goodappsw-form__label">${offerTexts.state}</label><input ${requiredFields.state?'required ':''}type="text"id="gaw_state"class="goodappsw-form__input"></div>` : ""
                    }

                    ${isBusinessField.company_name ?
                        `<div class="goodappsw-form__input-wrapper"><label for="gaw_company_name"class="goodappsw-form__label">${offerTexts.company_name}</label><input ${requiredFields.company_name?'required ':''}type="text"id="gaw_company_name"class="goodappsw-form__input"></div>` : ""
                    }

                    ${isBusinessField.website ?
                        `<div class="goodappsw-form__input-wrapper"><label for="gaw_website"class="goodappsw-form__label">${offerTexts.website}</label><input ${requiredFields.website?'required ':''}type="text"id="gaw_website"class="goodappsw-form__input"></div>` : ""
                    }

                    ${isBusinessField.tax_id ?
                        `<div class="goodappsw-form__input-wrapper"><label for="gaw_tax_id"class="goodappsw-form__label">${offerTexts.tax_id}</label><input ${requiredFields.tax_id?'required ':''}type="text"id="gaw_tax_id"class="goodappsw-form__input"></div>` : ""
                    }
                </div>
            `;const contactHtml=`
                <div class="goodappsw-form__content-right">
                    <h3 class="goodappsw-form__subtitle">${offerTexts.contact_title}</h3>

                    ${isContactsField.title ?
                        `<div class="goodappsw-form__input-wrapper"><label for="gaw_title"class="goodappsw-form__label">${offerTexts.fields_title}</label><input ${requiredFields.title?'required ':''}type="text"id="gaw_title"class="goodappsw-form__input"></div>` : ""
                    }

                    ${isContactsField.first_name ?
                        `<div class="goodappsw-form__input-wrapper"><label for="gaw_first_name"class="goodappsw-form__label">${offerTexts.first_name}</label><input ${requiredFields.first_name?'required ':''}type="text"id="gaw_first_name"class="goodappsw-form__input"></div>` : ""
                    }

                    ${isContactsField.last_name ?
                        `<div class="goodappsw-form__input-wrapper"><label for="gaw_last_name"class="goodappsw-form__label">${offerTexts.last_name}</label><input ${requiredFields.last_name?'required ':''}type="text"id="gaw_last_name"class="goodappsw-form__input"></div>` : ""
                    }

                    <div class="goodappsw-form__input-wrapper">
                        <label for="gaw_email" class="goodappsw-form__label">${offerTexts.email}</label>
                        <input required type="text" id="gaw_email" class="goodappsw-form__input">
                    </div>
                </div>
            `;const customCss=addFormCustomCss(offerItem,rootId);const html=`
                <div class="goodappsw-form__heading">
                    <h2 class="goodappsw-form__title">${offerTexts.title}</h2>
                    ${offerTexts.allow_set_description ? `<p class="goodappsw-form__description">${offerTexts.description}</p>` : ''}
                </div>

                <div class="goodappsw-form__body">
                    <form id="create_customer" class="goodappsw-form__form">
                        <div class="goodappsw-form__content">
                            ${isBusinessForm ? businessHtml : ''}
                            ${contactHtml}
                        </div>

                        <div class="goodappsw-form__action">
                            <p class="goodappsw-form__error-msg"></p>
                            <button type="submit" class="goodappsw-form__btn">${offerTexts.login_btn}</button>
                        </div>
                    </form>
                </div>

                ${customCss}
            `;const element=document.createElement("div");element.classList.add("goodappsw-form");element.innerHTML=html;const rootDiv=document.getElementById(rootId);rootDiv.append(element);if(isBusinessField.phone){initIntlTelInputLib(element);}
formActions({element,offerItem,rootId});setTimeout(()=>{rootDiv.style.display='block';},500);}
function addFormCustomCss(offerOptions,rootId){const customCss=offerOptions?.form?.custom_css;let result='';if(customCss){const styles=customCss.replace(/.goodappsw-/g,`#${rootId} .goodappsw-`);result=`<style>${styles}</style>`;}
return result;}
function getFormOfferTexts(dataOffer,offerItem){const{translate}=offerItem;const defaultLocale=dataOffer.current_lang;const defaultLang=translate[defaultLocale]||translate[Object.keys(translate)[0]];let currentLang=translate[currentLocale]||defaultLang;return{'title':currentLang.title||offerItem.title||'','allow_set_description':offerItem.allow_set_description||'','description':currentLang.description||offerItem.description||'','business_title':currentLang.business_title||defaultLang.business_title||'','contact_title':currentLang.contact_title||defaultLang.contact_title||'','login_btn':currentLang.login_btn||defaultLang.login_btn||'','fields_title':currentLang.fields_title||defaultLang.fields_title||'','first_name':currentLang.first_name||defaultLang.first_name||'','last_name':currentLang.last_name||defaultLang.last_name||'','email':currentLang.email||defaultLang.email||'','address':currentLang.address||defaultLang.address||'','address_2':currentLang.address_2||defaultLang.address_2||'','phone':currentLang.phone||defaultLang.phone||'','city':currentLang.city||defaultLang.city||'','postal_code':currentLang.postal_code||defaultLang.postal_code||'','country':currentLang.country||defaultLang.country||'','state':currentLang.state||defaultLang.state||'','company_name':currentLang.company_name||defaultLang.company_name||'','website':currentLang.website||defaultLang.website||'','tax_id':currentLang.tax_id||defaultLang.tax_id||'',}}
function formActions(params){const{element,offerItem}=params;const mainOfferId=offerItem.main_offer_id;const offerId=offerItem.id;const formNode=element.querySelector('#create_customer');const bodyNode=element.querySelector('.goodappsw-form__body');const approvalData={approval_type:offerItem.form.sign_up_form.allow_approve_signup,approve_msg:offerItem.form.sign_up_form.approve_msg,approve_tags:offerItem.form.sign_up_form.approve_tags,auto_tags:offerItem.form.auto_tags,auto_tags_msg:offerItem.form.auto_tags_msg,}
formNode.addEventListener("submit",event=>{event.preventDefault();const isValid=formValidation(element);if(isValid){bodyNode.classList.add("goodappsw-preload");createCustomerFetch(element,approvalData).then(response=>{sendStatistic(mainOfferId,offerId,true);showFormMessage(bodyNode,approvalData);}).catch(error=>{console.error(error);showErrorMessage(error);bodyNode.classList.remove("goodappsw-preload");});}});}
function showErrorMessage(error){const errorModal=document.querySelector("#goodappsw-error-modal")
if(errorModal){errorModal.remove();}
const element=document.createElement("div");element.id="goodappsw-error-modal";element.innerText=error;element.style.position="fixed";element.style.bottom="20px";element.style.left="51%";element.style.transform="translate(-50%, 0)";element.style.width="auto";element.style.background="#FF0000CC";element.style.color="#FFFFFF";element.style.fontSize="16px";element.style.fontWeight="bold";element.style.boxShadow="0px 10px 20px rgba(0, 0, 0, 0.15)";element.style.borderRadius="4px";element.style.padding="12px 32px";element.style.zIndex="9999999999";document.body.append(element);setTimeout(()=>{element.remove();},5000)}
function showFormMessage(bodyNode,approvalData){const msg=approvalData.approval_type===approvalType.manual?approvalData.approve_msg:approvalData.auto_tags_msg;bodyNode.innerHTML=`<p class="goodappsw-form__msg">${msg}</p>`;bodyNode.classList.remove("goodappsw-preload");}
function createFormRequest(element,approvalData){const tags=approvalData.approval_type===approvalType.manual?approvalData.approve_tags:approvalData.auto_tags;const title=element.querySelector('#gaw_title')?element.querySelector('#gaw_title').value:"";const first_name=element.querySelector('#gaw_first_name')?element.querySelector('#gaw_first_name').value:"";const last_name=element.querySelector('#gaw_last_name')?element.querySelector('#gaw_last_name').value:"";const email=element.querySelector('#gaw_email')?element.querySelector('#gaw_email').value:"";const address1=element.querySelector('#gaw_address')?element.querySelector('#gaw_address').value:"";const address2=element.querySelector('#gaw_address_2')?element.querySelector('#gaw_address_2').value:"";const phone=element.querySelector('#gaw_phone')?element.querySelector('#gaw_phone').getAttribute('data-full-number')||"":"";const city=element.querySelector('#gaw_city')?element.querySelector('#gaw_city').value:"";const zip=element.querySelector('#gaw_postal_code')?element.querySelector('#gaw_postal_code').value:"";const country=element.querySelector('#gaw_country')?element.querySelector('#gaw_country').value:"";const province=element.querySelector('#gaw_state')?element.querySelector('#gaw_state').value:"";const company=element.querySelector('#gaw_company_name')?element.querySelector('#gaw_company_name').value:"";const website=element.querySelector('#gaw_website')?element.querySelector('#gaw_website').value:"";const tax_id=element.querySelector('#gaw_tax_id')?element.querySelector('#gaw_tax_id').value:"";let note='';if(title){note=note+'\\r\\n\\r\\n Title: '+title;}
if(company){note=note+'\\r\\n\\r\\n Company: '+company;}
if(website){note=note+'\\r\\n\\r\\n Website: '+website;}
if(tax_id){note=note+'\\r\\n\\r\\n Tax ID: '+tax_id;}
return{domain:goodappswShop,customer:{first_name,last_name,email,phone,tags,note,addresses:{address1,address2,city,province,phone,zip,country}}}}
function formValidation(element){const emailInput=element.querySelector('#gaw_email');const mailformat=/^\w+[^@]+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,10})+$/;const errorNode=element.querySelector('.goodappsw-form__error-msg')
if(emailInput.value&&!emailInput.value.match(mailformat)){errorNode.innerText='You have entered an invalid email address!';emailInput.focus();return false;}
errorNode.innerText='';return true;}
function initIntlTelInputLib(element){const link=document.createElement('link');link.type='text/css';link.rel='stylesheet';link.href=`https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css`;document.head.appendChild(link);const script=document.createElement("script");script.src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js";document.head.appendChild(script);script.addEventListener("load",()=>{if(window.intlTelInput){phoneNumberInputEvent(element)}});};function phoneNumberInputEvent(element){const input=element.querySelector('#gaw_phone');const errorMsg=element.querySelector('#gaw_phone_error_msg');const errorMap=["Invalid number","Invalid country code","Too short","Too long","Invalid number"];let countryData=window.intlTelInputGlobals.getCountryData();const iti=window.intlTelInput(input,{hiddenInput:"full_phone",utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"});for(let i=0;i<countryData.length;i++){let country=countryData[i];let optionNode=document.createElement("option");optionNode.value=country.iso2;let textNode=document.createTextNode(country.name);optionNode.appendChild(textNode);}
iti.setCountry('us');dialCode=iti.getSelectedCountryData().dialCode;input.addEventListener('countrychange',function(e){dialCode=iti.getSelectedCountryData().dialCode;});const reset=()=>{if(errorMsg){errorMsg.style.display='none';input.style.borderColor='';}};input.addEventListener('blur',()=>{reset();if(input.value.trim()){if(!iti.isValidNumber()){input.style.borderColor='#ff0000';const errorCode=iti.getValidationError();if(errorMsg){errorMsg.innerHTML=errorMap[errorCode];errorMsg.style.display='block';}}else{const number=iti.getNumber();input.setAttribute('data-full-number',number);}}});input.addEventListener('change',reset);input.addEventListener('keyup',reset);}
async function createCustomerFetch(element,approvalData){const options={method:'POST',headers:{'Content-Type':'application/json',"Accept":"application/json"},body:JSON.stringify(createFormRequest(element,approvalData))};let url=goodappswApiUrl+`api/front/create-customer`;const resp=await fetch(url,options);if(!resp.ok){const errorMsg=await resp.json();const firstPart=Object.keys(errorMsg)[0]||'HTTP error, status = ${resp.status}';const secondPart=Object.values(errorMsg)[0]?` - ${Object.values(errorMsg)[0]}`:'';throw new Error(`${firstPart}${secondPart}`);}
return await resp.text();}};goodappswApp();}